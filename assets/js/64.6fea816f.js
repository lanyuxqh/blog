(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{625:function(t,s,a){"use strict";a.r(s);var e=a(5),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"第13章-reflect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第13章-reflect"}},[t._v("#")]),t._v(" 第13章_Reflect")]),t._v(" "),a("h2",{attrs:{id:"一、概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、概述"}},[t._v("#")]),t._v(" 一、概述")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("Reflect")]),t._v("对象的设计目的")])]),t._v(" "),a("ul",[a("li",[t._v("将"),a("code",[t._v("Object")]),t._v("对象的一些明显属于语言内部的方法放到"),a("code",[t._v("Reflect")]),t._v("对象上。即从"),a("code",[t._v("Reflect")]),t._v("对象上可以拿到语言内部的方法。\n"),a("ul",[a("li",[t._v("修改某些"),a("code",[t._v("Object")]),t._v("方法的返回结果，让其变得更合理。")]),t._v(" "),a("li",[t._v("让"),a("code",[t._v("Object")]),t._v("操作都变成函数行为。")]),t._v(" "),a("li",[a("code",[t._v("Reflect")]),t._v("对象的方法与"),a("code",[t._v("Proxy")]),t._v("对象的方法一一对应，只要是"),a("code",[t._v("Proxy")]),t._v("对象的方法，就能在"),a("code",[t._v("Reflect")]),t._v("对象上找到对应的方法。这就让"),a("code",[t._v("Proxy")]),t._v("对象可以方便地调用对应的"),a("code",[t._v("Reflect")]),t._v("方法，完成默认行为，作为修改行为的基础。")])])])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[t._v("Reflect")]),t._v("并非一个构造函数，所以不能通过new运算符对其进行调用，或者将"),a("code",[t._v("Reflect")]),t._v("对象作为一个函数来调用。")])]),t._v(" "),a("h2",{attrs:{id:"二、静态方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、静态方法"}},[t._v("#")]),t._v(" 二、静态方法")]),t._v(" "),a("ul",[a("li",[t._v("Reflect.apply(target, thisArg, args)\n"),a("ul",[a("li",[t._v("返回值是调用完带着指定参数和 "),a("code",[t._v("this")]),t._v(" 值的给定的函数后返回的结果。")])])]),t._v(" "),a("li",[t._v("Reflect.construct(target, args)\n"),a("ul",[a("li",[t._v("返回以"),a("code",[t._v("target")]),t._v("函数为构造函数，"),a("code",[t._v("argumentList")]),t._v("为其初始化参数的对象实例。")])])]),t._v(" "),a("li",[t._v("Reflect.get(target, name, receiver)\n"),a("ul",[a("li",[t._v("返回"),a("code",[t._v("target")]),t._v("对象的"),a("code",[t._v("name")]),t._v("属性，如果没有该属性，则返回"),a("code",[t._v("undefined")]),t._v("。")]),t._v(" "),a("li",[t._v("如果"),a("code",[t._v("name")]),t._v("属性部署了读取函数（getter），则读取函数的"),a("code",[t._v("this")]),t._v("绑定"),a("code",[t._v("receiver")]),t._v("。")])])]),t._v(" "),a("li",[t._v("Reflect.set(target, name, value, receiver)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明是否成功设置属性。")]),t._v(" "),a("li",[t._v("如果"),a("code",[t._v("name")]),t._v("属性设置了赋值函数，则赋值函数的"),a("code",[t._v("this")]),t._v("绑定"),a("code",[t._v("receiver")]),t._v("。")])])]),t._v(" "),a("li",[t._v("Reflect.defineProperty(target, name, desc)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明属性是否被成功定义。")])])]),t._v(" "),a("li",[t._v("Reflect.deleteProperty(target, name)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明该属性是否被成功删除。")])])]),t._v(" "),a("li",[t._v("Reflect.has(target, name)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明是否存在此属性。")])])]),t._v(" "),a("li",[t._v("Reflect.ownKeys(target)\n"),a("ul",[a("li",[t._v("返回由目标对象的自身属性键组成的"),a("code",[t._v("Array")]),t._v("。")])])]),t._v(" "),a("li",[t._v("Reflect.isExtensible(target)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明该对象是否可扩展。")])])]),t._v(" "),a("li",[t._v("Reflect.preventExtensions(target)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明目标对象是否成功被设置为不可扩展。")])])]),t._v(" "),a("li",[t._v("Reflect.getOwnPropertyDescriptor(target, name)\n"),a("ul",[a("li",[t._v("如果属性存在于给定的目标对象中，则返回属性描述符；否则，返回 "),a("code",[t._v("undefined")]),t._v("。")])])]),t._v(" "),a("li",[t._v("Reflect.getPrototypeOf(target)\n"),a("ul",[a("li",[t._v("返回给定对象的原型。如果给定对象没有继承的属性，则返回 "),a("code",[t._v("null")]),t._v("。")])])]),t._v(" "),a("li",[t._v("Reflect.setPrototypeOf(target, prototype)\n"),a("ul",[a("li",[t._v("返回一个"),a("code",[t._v("Boolean")]),t._v("值表明是否原型已经成功设置。")])])])]),t._v(" "),a("h2",{attrs:{id:"三、使用-proxy-实现观察者模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、使用-proxy-实现观察者模式"}},[t._v("#")]),t._v(" 三、使用 Proxy 实现观察者模式")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("观察者模式（Observer mode）指的是函数自动观察数据对象，一旦对象有变化，函数就会自动执行。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" person "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据对象person是观察目标")]),t._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'张三'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 函数print是观察者")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(", ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("person"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("age"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("print"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nperson"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'李四'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 李四, 20")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("使用 Proxy 写一个观察者模式的最简单实现，即实现"),a("code",[t._v("observable")]),t._v("和"),a("code",[t._v("observe")]),t._v("这两个函数。思路是"),a("code",[t._v("observable")]),t._v("函数返回一个原始对象的 Proxy 代理，拦截赋值操作，触发充当观察者的各个函数。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" queuedObservers "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("observe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("fn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" queuedObservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("observable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Reflect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" receiver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  queuedObservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("observer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);