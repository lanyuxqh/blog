---
title: JS高程 | 第4章_变量、作用域和内存问题
date: 2021-3-31
tags:
  - 读书笔记
  - javascript
categories:
  - 读书笔记
---

# 第 4 章\_变量、作用域和内存问题

## 4.1 基本类型和引用类型的值

- 基本类型值是按值访问的，可以操作保存在变量中的实际的值。
- 引用类型值是按引用访问的，实际上是在操作对象的引用而不是实际的对象。

### 4.1.1 动态的属性

- 对于引用类型的值，我们可以为其添加属性和方法，也可以改变和删除其属性和方法。
- 我们不能给基本类型的值添加属性，尽管这样做不会导致任何错误。

### 4.1.2 复制变量值

- 如果从一个变量向另一个变量复制基本类型的值，会在变量对象上创建一个新值，然后把该值复制到为新变量分配的位置上。两个变量完全独立。
- 如果从一个变量向另一个变量复制引用类型的值，同样也会将存储在变量对象中的值复制一份放到为新变量分配的空间中。不同的是，这个值的副本实际上是一个指针，而这个指针指向存储在堆中的一个对象。复制操作结束后，两个变量实际上将引用同一个对象。因此，改变其中一个变量，就会影响另一个变量。

### 4.1.3 传递参数

- ECMAScript 中所有函数的参数都是按值传递的。

### 4.1.4 检测类型

- 基本数据类型用 typeof 操作符。
- 引用类型用 instanceof 操作符。

## 4.2 执行环境及作用域

- 作用域链的用途，是保证对执行环境有权访问的所有变量和函数的有序访问。

- 内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。

### 4.2.1 延长作用域链

- 可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。
- 对 with 语句来说，会将指定的对象添加到作用域链中。
- 对 catch 语句来说，会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明。

### 4.2.2 没有块级作用域

- 声明变量：使用 var 声明的变量会自动被添加到最接近的环境中。在函数内部，最接近的环境就是函数的局部环境；在 with 语句中，最接近的环境是函数环境。如果初始化变量时没有使用 var 声明，该变量会自动被添加到全局环境。
- 查询标识符：当在某个环境中为了读取或写入而引用一个标识符时，必须通过搜索来确定该标识符实际代表什么。搜索过程从作用域链的前端开始，向上逐级查询与给定名字匹配的标识符。如果在局部环境中找到了该标识符，搜索过程停止，变量就绪。如果在局部环境中没有找到该变量名，则继续沿作用域链向上搜索。搜索过程将一直追溯到全局环境的变量对象。如果在全局环境中也没有找到这个标识符，则意味着该变量尚未声明。

## 4.3 垃圾收集

> JavaScript 是一门具有自动垃圾收集机制的编程语言，开发人员不必关心内存分配和回收问题。

### 4.3.1 标记清除

- “标记清除”是目前主流的垃圾收集算法，这种算法的思想是给当前不使用的值加上标记，然后再回收其内存。
- 当变量进入环境（例如，在函数中声明一个变量）时，就将这个变量标记为“进入环境”。当变量离开环境时，则将其标记为“离开环境”。

### 4.3.2 引用计数

- 跟踪记录每个值被引用的次数。
- 存在问题：循环引用，指的是对象 A 中包含一个指向对象 B 的指针，而对象 B 中也包含一个指向对象 A 的引用。

### 4.3.3 性能问题

### 4.3.4 管理内存

- 解除变量的引用不仅有助于消除循环引用现象，而且对垃圾收集也有好处。为了确保有效地回收内存，应该及时解除不再使用的全局对象、全局对象属性以及循环引用变量的引用。
