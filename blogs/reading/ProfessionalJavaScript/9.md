---
title: JS高程 | 第9章_客户端检测
date: 2021-2-25
tags:
  - 读书笔记
  - javascript
categories:
  - 读书笔记
---

# 第 9 章\_客户端检测

由于浏览器间存在差别，通常需要根据不同浏览器的能力分别编写不同的代码。

## 1、能力检测

- 在编写代码之前先检测特定浏览器的能力。

- 例如，脚本在调用某个函数之前，可能要先检测该函数是否存在。

- 优点：法将开发人员从考虑具体的浏览器类型和版本中解放出来，让他们把注意力集中到相应的能力是否存在上。
- 缺点：无法精确地检测特定的浏览器和版本。

#### 1.1 更可靠的能力检测

尽量使用 typeof 进行能力检测

#### 1.2 能力检测，不是浏览器检测

在实际开发中，应该将能力检测作为确定下一步解决方案的依据，而不是用它来判断用户使用的是什么浏览器。

## 2、怪癖检测

- 怪癖实际上是浏览器实现中存在的 bug。
- 例如早期的 WebKit 中就存在一个怪癖，即它会在 for-in 循环中返回被隐藏的属性。
- 怪癖检测通常涉及到运行一小段代码，然后确定浏览器是否存在某个怪癖。
- 缺点：与能力检测相比效率更低；无法精确地检测特定的浏览器和版本。

## 3、用户代理检测

- 通过检测用户代理字符串来识别浏览器。
- 用户代理字符串中包含大量与浏览器有关的信息，包括浏览器、平台、操作系统及浏览器版本。
- 用户代理检测需要特殊的技巧，特别是要注意 Opera 会隐瞒其用户代理字符串的情况。

#### 3.1 用户代理字符串的历史

- 早期的浏览器 Mozilla/版本号 [语言] (平台; 加密类型)
- Netscape Navigator 3 和 Internet Explorer 3 Mozilla/版本号 (平台; 加密类型 [; 操作系统或 CPU 说明]) Mozilla/2.0 (compatible; MSIE 版本号; 操作系统)
- Netscape Communicator 4 和 IE4 ～ IE8
- Gecko
- WebKit
- Konqueror
- Chrome
- Opera
- iOS 和 Android

#### 3.2 用户代理字符串检测技术

一般情况下，知道**呈现引擎**和**最低限度的版本**就足以决定正确的操作方法了。

#### 3.3 完整的代码

完整的用户代理字符串检测脚本，包括检测呈现引擎、平台、Windows 操作系统、移动设备和游戏系统。

#### 3.4 使用方法

用户代理检测一般适用于下列情形：

- 不能直接准确地使用能力检测或怪癖检测。例如，某些浏览器实现了为将来功能预留的存根（stub）函数。在这种情况下，仅测试相应的函数是否存在还得不到足够的信息。
- 同一款浏览器在不同平台下具备不同的能力。这时候，可能就有必要确定浏览器位于哪个平台下。
- 为了跟踪分析等目的需要知道确切的浏览器。

## 4、小结

- 在决定使用哪种客户端检测方法时，一般应优先考虑使用能力检测。
- 怪癖检测是确定应该如何处理代码的第二选择。
- 而用户代理检测则是客户端检测的最后一种方案，因为这种方法对用户代理字符串具有很强的依赖性。
