<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue梳理 | 懒鱼</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/avatar.png">
    <meta name="description" content="人生海海，山山而川，不过尔尔">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/blog/assets/css/0.styles.01683485.css" as="style"><link rel="preload" href="/blog/assets/js/app.387a4331.js" as="script"><link rel="preload" href="/blog/assets/js/3.726877f8.js" as="script"><link rel="preload" href="/blog/assets/js/1.9301d524.js" as="script"><link rel="preload" href="/blog/assets/js/87.c93cbf58.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a1492cb6.js"><link rel="prefetch" href="/blog/assets/js/11.ebcf6731.js"><link rel="prefetch" href="/blog/assets/js/12.4abfdb1d.js"><link rel="prefetch" href="/blog/assets/js/13.f9672bb9.js"><link rel="prefetch" href="/blog/assets/js/14.6da54a7b.js"><link rel="prefetch" href="/blog/assets/js/15.e4b5eae1.js"><link rel="prefetch" href="/blog/assets/js/16.01a93112.js"><link rel="prefetch" href="/blog/assets/js/17.6852a839.js"><link rel="prefetch" href="/blog/assets/js/18.cbdd8c20.js"><link rel="prefetch" href="/blog/assets/js/19.042fe1fc.js"><link rel="prefetch" href="/blog/assets/js/20.1964c8d1.js"><link rel="prefetch" href="/blog/assets/js/21.724e6b07.js"><link rel="prefetch" href="/blog/assets/js/22.6d27de77.js"><link rel="prefetch" href="/blog/assets/js/23.e537ebcb.js"><link rel="prefetch" href="/blog/assets/js/24.23cb264f.js"><link rel="prefetch" href="/blog/assets/js/25.19318740.js"><link rel="prefetch" href="/blog/assets/js/26.7ddff615.js"><link rel="prefetch" href="/blog/assets/js/27.208ef136.js"><link rel="prefetch" href="/blog/assets/js/28.b9ab4b22.js"><link rel="prefetch" href="/blog/assets/js/29.1e1400cd.js"><link rel="prefetch" href="/blog/assets/js/30.7df6a660.js"><link rel="prefetch" href="/blog/assets/js/31.ba5ede5c.js"><link rel="prefetch" href="/blog/assets/js/32.63090c48.js"><link rel="prefetch" href="/blog/assets/js/33.b1fb0364.js"><link rel="prefetch" href="/blog/assets/js/34.b0278b3e.js"><link rel="prefetch" href="/blog/assets/js/35.32d147f3.js"><link rel="prefetch" href="/blog/assets/js/36.53ed9db4.js"><link rel="prefetch" href="/blog/assets/js/37.4735eae4.js"><link rel="prefetch" href="/blog/assets/js/38.a9f10826.js"><link rel="prefetch" href="/blog/assets/js/39.d65a996c.js"><link rel="prefetch" href="/blog/assets/js/4.8733cb93.js"><link rel="prefetch" href="/blog/assets/js/40.3bba8b79.js"><link rel="prefetch" href="/blog/assets/js/41.c58681d5.js"><link rel="prefetch" href="/blog/assets/js/42.a9165ebb.js"><link rel="prefetch" href="/blog/assets/js/43.320668db.js"><link rel="prefetch" href="/blog/assets/js/44.8aa3291c.js"><link rel="prefetch" href="/blog/assets/js/45.4cd6cca4.js"><link rel="prefetch" href="/blog/assets/js/46.854b59fb.js"><link rel="prefetch" href="/blog/assets/js/47.15ee442a.js"><link rel="prefetch" href="/blog/assets/js/48.f09282ef.js"><link rel="prefetch" href="/blog/assets/js/49.472fa3e4.js"><link rel="prefetch" href="/blog/assets/js/5.0430080b.js"><link rel="prefetch" href="/blog/assets/js/50.9076a992.js"><link rel="prefetch" href="/blog/assets/js/51.7e5b4b07.js"><link rel="prefetch" href="/blog/assets/js/52.5d0e953f.js"><link rel="prefetch" href="/blog/assets/js/53.94d95a1d.js"><link rel="prefetch" href="/blog/assets/js/54.151ae36e.js"><link rel="prefetch" href="/blog/assets/js/55.9234ff90.js"><link rel="prefetch" href="/blog/assets/js/56.f944814c.js"><link rel="prefetch" href="/blog/assets/js/57.6619482b.js"><link rel="prefetch" href="/blog/assets/js/58.1f337e43.js"><link rel="prefetch" href="/blog/assets/js/59.90736c1f.js"><link rel="prefetch" href="/blog/assets/js/6.0fc8488b.js"><link rel="prefetch" href="/blog/assets/js/60.6a117a85.js"><link rel="prefetch" href="/blog/assets/js/61.82572db1.js"><link rel="prefetch" href="/blog/assets/js/62.d9db0071.js"><link rel="prefetch" href="/blog/assets/js/63.9ad82599.js"><link rel="prefetch" href="/blog/assets/js/64.6fea816f.js"><link rel="prefetch" href="/blog/assets/js/65.985f6647.js"><link rel="prefetch" href="/blog/assets/js/66.b34d0f3f.js"><link rel="prefetch" href="/blog/assets/js/67.b33799c9.js"><link rel="prefetch" href="/blog/assets/js/68.ac5d5402.js"><link rel="prefetch" href="/blog/assets/js/69.1da1f8e5.js"><link rel="prefetch" href="/blog/assets/js/7.0523ec6a.js"><link rel="prefetch" href="/blog/assets/js/70.39e6b79b.js"><link rel="prefetch" href="/blog/assets/js/71.175e5778.js"><link rel="prefetch" href="/blog/assets/js/72.67b18944.js"><link rel="prefetch" href="/blog/assets/js/73.642e3eff.js"><link rel="prefetch" href="/blog/assets/js/74.f9e45d57.js"><link rel="prefetch" href="/blog/assets/js/75.42c39bb9.js"><link rel="prefetch" href="/blog/assets/js/76.eb0b9539.js"><link rel="prefetch" href="/blog/assets/js/77.a07caaff.js"><link rel="prefetch" href="/blog/assets/js/78.974d2554.js"><link rel="prefetch" href="/blog/assets/js/79.03e96a46.js"><link rel="prefetch" href="/blog/assets/js/8.fef34909.js"><link rel="prefetch" href="/blog/assets/js/80.11d13e0b.js"><link rel="prefetch" href="/blog/assets/js/81.4f57bbcb.js"><link rel="prefetch" href="/blog/assets/js/82.2d8d5e1d.js"><link rel="prefetch" href="/blog/assets/js/83.5f9dda84.js"><link rel="prefetch" href="/blog/assets/js/84.33591a75.js"><link rel="prefetch" href="/blog/assets/js/85.c812579c.js"><link rel="prefetch" href="/blog/assets/js/86.0b130fb3.js"><link rel="prefetch" href="/blog/assets/js/88.df65d670.js"><link rel="prefetch" href="/blog/assets/js/89.0fe63c00.js"><link rel="prefetch" href="/blog/assets/js/9.eea1a7ca.js"><link rel="prefetch" href="/blog/assets/js/90.f0de0c17.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.01683485.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>懒鱼</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>人生海海，山山而川，不过尔尔</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>懒鱼</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/avatar.png" alt="懒鱼" class="logo"> <span class="site-name">懒鱼</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/区块链/" class="nav-link"><i class="undefined"></i>
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/计算机网络/" class="nav-link"><i class="undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/浏览器/" class="nav-link"><i class="undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/刷题/" class="nav-link"><i class="undefined"></i>
  刷题
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/es6/" class="nav-link"><i class="undefined"></i>
  es6
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/html/" class="nav-link"><i class="undefined"></i>
  html
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/javascript/" class="nav-link"><i class="undefined"></i>
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/读书笔记/" class="nav-link"><i class="undefined"></i>
  读书笔记
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/blog/others/message-board.html" class="nav-link"><i class="iconfont reco-suggestion"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      关于我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lanyuxqh" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://lanyuxqh.github.io/xqh-vue-ui-doc/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-document"></i>
  xqh-vue-ui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><img src="/blog/avatar.png" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    懒鱼
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>78</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>13</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/区块链/" class="nav-link"><i class="undefined"></i>
  区块链
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/计算机网络/" class="nav-link"><i class="undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/浏览器/" class="nav-link"><i class="undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/刷题/" class="nav-link"><i class="undefined"></i>
  刷题
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/es6/" class="nav-link"><i class="undefined"></i>
  es6
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/html/" class="nav-link"><i class="undefined"></i>
  html
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/javascript/" class="nav-link"><i class="undefined"></i>
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/读书笔记/" class="nav-link"><i class="undefined"></i>
  读书笔记
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/blog/others/message-board.html" class="nav-link"><i class="iconfont reco-suggestion"></i>
  留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      关于我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lanyuxqh" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://lanyuxqh.github.io/xqh-vue-ui-doc/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-document"></i>
  xqh-vue-ui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Vue梳理</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>懒鱼</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2022
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">Vue梳理</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>懒鱼</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2022/6/11</span></i> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>vue</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="vue-梳理"><a href="#vue-梳理" class="header-anchor">#</a> Vue 梳理</h1> <h2 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1. 概述</h2> <h3 id="_1-1-对-vue-的整体理解"><a href="#_1-1-对-vue-的整体理解" class="header-anchor">#</a> 1.1 对 VUE 的整体理解</h3> <ul><li><p>vue 可以通过<strong>vue-cli</strong>快速初始化项目，做到开箱即用，轻量便捷。从利于前端工程化的角度去考虑使用前端框架，可以提高开发效率和开发质量。</p></li> <li><p>vue 具有<strong>组件化</strong>特点，使得代码得到复用。</p> <ul><li>组件通过 prop 进行数据传递，集成<code>EventBus</code>进行事件注册监听和事件触发，使用<code>slot</code>进行内容分发。</li> <li>还实现了一套声明式模板系统，在<code>runtime</code>或者预编译是对模板进行编译，生成渲染函数，供组件渲染视图使用。</li></ul></li> <li><p>vue 具有<strong>响应式编程</strong>特点。</p> <ul><li>通过 Object.defineProperty 进行数据拦截，实现数据响应式。</li> <li>通过 Dep 和 Watcher 实现依赖收集和更新通知，核心是数据使用时收集依赖，数据更新时通知更新，实现双向数据绑定。</li> <li>数据响应式是用来服务双向数据绑定的。</li></ul></li> <li><p>vue 使用<strong>虚拟 DOM 和 diff 算法</strong>，提高性能。</p> <ul><li>用 JS 对象模拟 DOM。</li> <li>通过 render 函数把虚拟 DOM 转成真实 DOM 并插入页面中。</li> <li>diff 算法用来比较同层级的新旧节点差异，如果有事件发生修改了虚拟 DOM，比较两棵虚拟 DOM 树的差异，得到差异对象。</li> <li>使用 patch 把差异对象应用到真正的 DOM 树上。</li></ul></li> <li><p>利用<strong>VueRouter 路由机制</strong>实现单页面应用，页面局部刷新，不需要每次切换路由都向后端发起请求。</p></li> <li><p>利用<strong>Vuex 集中式存储</strong>管理应用的所有组件的状态，为复杂组件间的通信提供解决方案。</p></li> <li><p><strong>vue 是单页面应用</strong>，使页面局部刷新，不用每次跳转页面都要请求所有数据和 dom，这样大大加快了访问速度和提升用户体验。而且它的第三方 ui 库节省开发时间。</p></li></ul> <h3 id="_1-2-渐进式框架"><a href="#_1-2-渐进式框架" class="header-anchor">#</a> 1.2 渐进式框架</h3> <p>渐进式框架（自底向上增量开发的设计）。渐进式框架就是指强制主张最少，没有多做职责之外的事。</p> <ul><li>每个框架都有各自的特点，会对开发者有一定的要求，比如 Angular 就是强主张型的，如果要用它就必须使用它的（模板机制、依赖注入等），React 的主张程度相对弱一些，它是具有函数式编程的理念，需要调用 api 去修改数据。</li> <li>而对于 Vue 来说并没有强主张，开发者需要什么就去做什么，不是说强制一定要使用一些全家桶之类的，可以&quot;按需使用&quot;。</li></ul> <h3 id="_1-3-对比其他框架"><a href="#_1-3-对比其他框架" class="header-anchor">#</a> 1.3 对比其他框架</h3> <table><thead><tr><th style="text-align:center;">框架</th> <th>描述</th></tr></thead> <tbody><tr><td style="text-align:center;">JQuery</td> <td>更方便的选取和操作 DOM 对象、数据和界面是在一起的。</td></tr> <tr><td style="text-align:center;">Vue</td> <td>更注重 web 开发者的习惯，用 HTML 渲染模板；声明式编程（直接赋值）；push-based；v-model 双向数据流；vuex 使用的是可变的数据；vue-cli</td></tr> <tr><td style="text-align:center;">React</td> <td>用 JSX 渲染模板；函数式编程（需要调用 api 去修改数据）；pull-based；单向数据流；redux 使用的是不可变的数据；Create React App (CRA)；需要对虚拟 DOM 渲染出来的结果做脏检查</td></tr> <tr><td style="text-align:center;">Angular</td> <td>声明式编程；脏检查，所以 watcher 越多越慢</td></tr></tbody></table> <h4 id="_1-3-1-react"><a href="#_1-3-1-react" class="header-anchor">#</a> 1.3.1 React</h4> <p><strong>不同点</strong>：</p> <ul><li>React 采用 Virtual DOM 会对渲染出来的结果做脏检查；</li> <li><strong>数据管理</strong>：Vuex 管理可变数据，直接修改；Redux 管理不可变数据，新替旧</li> <li><strong>代码风格</strong>：react 推荐 jsx，把 html，css 都写进 js 里面，all in js；vue 推荐 webpack+vue-loader 的单文件组件格式，html，css，js 都写在.vue 里面。</li> <li>React 不使用模板，它要求开发者借助 JSX 在 JavaScript 中创建 DOM。函数式编程，是类式写法，api 很少；vue 用模板搭建项目。使用声明式写法，传入各种 options,api 和参数都很多，但 vue3.0 支持类式写法。</li> <li>数据流，</li></ul> <p><strong>相同点</strong>：</p> <ul><li>React 采用独特的 JSX 语法，Vue.js 在组件开发中也推崇编写.vue 特殊文件格式，对文件内容都有一些约定；</li> <li>两者都需要编译后使用；</li> <li>中心实现相同：一切都是组件，组件实例之间可以嵌套；</li> <li>都提供合理的钩子函数，可以让开发者定制化地处理需求，都不内置列数 Ajax，Route 等功能到核心包，而是以插件的方式加载；</li> <li>在组件开发中都支持 mixins 的特性了。</li></ul> <h4 id="_1-3-2-angularjs"><a href="#_1-3-2-angularjs" class="header-anchor">#</a> 1.3.2 AngularJs</h4> <p><strong>相同点</strong>：都支持指令，内置指令和自定义指令；都支持过滤器：内置过滤器和自定义过滤器；都支持双向数据绑定，都不支持低端浏览器；</p> <p><strong>不同点</strong>：AngularJs 的学习成本高，比如 Dependency、Injecttion 特性，而 vue.js 本身提供的 API 都比较简单、直观；在性能上，AngularJs 依赖对数据做脏检查，所以 watcher 越多越慢；Vue.js 使用基于依赖追踪的观察并且使用异步队列更新，所以的数据都是独立触发的。</p> <h4 id="_1-3-3-jquery"><a href="#_1-3-3-jquery" class="header-anchor">#</a> 1.3.3 JQuery</h4> <p>Vue 直接操作视图层，它通过 Vue 对象将数据和 View 完全分离开来了。对数据进行操作不需要引用相应的 DOM 节点，只需要关注逻辑，完全实现了视图层和逻辑层的解耦；</p> <p>Jquery 的操作是基于 DOM 节点的操作，jQuery 是使用选择器（$）选取 DOM 对象，对其进行赋值、取值、事件绑定等操作，其实和原生的 js 的区别只在于可以更方便的选取和操作 DOM 对象，而数据和界面是在一起的。它的优势在于良好的封装和兼容，使调用简单方便。</p> <h3 id="_1-4-vue-cli-脚手架"><a href="#_1-4-vue-cli-脚手架" class="header-anchor">#</a> 1.4 vue-cli 脚手架</h3> <p><strong>脚手架</strong>：根据业务需求或者功能需求，把需要配置的 webpack 以及一些每一次都要做的事情进行封装，以后根据脚手架安装，就可以快速进行应用开发，开箱即用。</p> <p><strong>vue 工程化</strong>：项目中需要基于工程化开发来管理 vue 项目。vue-cli 是一个基于 vue.js 进行快速开发的完整系统，打造 vue 工程化。</p> <ul><li>vue.js：vue-cli 工程的核心，主要特点是组件系统和双向数据绑定。</li> <li>vue-router：vue 官方推荐使用的路由框架。</li> <li>vuex：专为 Vue.js 应用项目开发的状态管理器，主要用于维护 vue 组件间共用的一些变量和方法。</li> <li>axios（ 或者 fetch 、ajax ）：用于发起 GET 、或 POST 等 http 请求，基于 Promise 设计。</li> <li>vux：一个专为 vue 设计的移动端 UI 组件库。</li> <li>创建一个 emit.js 文件，用于 vue 事件机制的管理。</li> <li>webpack：模块加载和 vue-cli 工程打包器。</li></ul> <p><strong>vue-cli 文件目录</strong>：</p> <ul><li><p>node_modules：安装的各个模块</p></li> <li><p>public</p> <ul><li>index.html：最后编译项目时候的页面模版
<ul><li>webpack 打包编译时，页面模板也会跟着编译，把 html 压缩，把编译后的 css 和 js 插入到页面模板中。</li> <li>单独自己导入一些资源，基于<code>&lt;%= BASE_URL %&gt;</code>指定相对引入的地址</li> <li>需要在页面上留一个容器，最后编译时会把所有内容插入到这个容器</li></ul></li></ul></li> <li><p>src：包含整个项目中所需要的内容和代码（脚手架生成的 webpack 配置，只对 src 目录进行编译处理，其他目录不处理）</p> <ul><li>main.js：项目入口（单页面一个入口）</li> <li>App.vue：index.html 页面的主要入口</li> <li>components：公共组件</li> <li>views：主组件入口</li> <li>pages：每一个单独的业务板块或者页面</li> <li>assets：项目需要的静态资源文件，images、css、lib...</li> <li>api：axios 的二次配置或者一些接口的数据管理</li> <li>store：管理 vuex 的一套信息</li> <li>router：管理 vue-router 中的一套信息</li> <li>...</li></ul></li> <li><p>babel.config.js：babel 的配置信息（编译解析 js 的）</p></li> <li><p>package.json：当前项目的模块依赖清单</p> <ul><li>scripts：配置可执行的脚本命令
<ul><li>npm run serve：开发环境下预览项目</li> <li>npm run build：项目打包到 dist 目录，之后部署到服务器</li></ul></li> <li>dependencies：生产依赖</li> <li>devDependencies：开发依赖</li> <li>eslintConfig：词法解析规则，可以自定义 ESLINT 词法检测规则</li> <li>browserslist：配置浏览器兼容列表</li></ul></li> <li><p>vue.config.js：vue-cli 的进阶配置</p> <ul><li>module.exports ={配置项 1，配置项 2...}
<ul><li>常用配置：
<ul><li>publicPath：指定所有插入资源的统一前缀路径</li> <li>pages：配置多页面</li> <li>lintOnSave：在开发环境下，是否每次代码编译都执行词法检测（默认 true，一般禁掉）</li> <li>productionSourceMap：相当于压缩后的文件对照源码的映射，方便调试（默认 true，一般禁掉）</li> <li>devServer：host、port、https 配置</li> <li>devServer.proxy：开发环境下将 API 请求代理到 API 服务器。</li></ul></li></ul></li> <li>环境变量和模式
<ul><li>.env.development
<ul><li>NOSE_ENV=development</li> <li>BASE_URL=&quot;http://127.0.0.1:8080&quot;</li></ul></li> <li>.env.production
<ul><li>NOSE_ENV=production</li> <li>BASE_URL=&quot;http://www.baidu.com&quot;</li></ul></li></ul></li></ul></li></ul> <h2 id="_2-vue"><a href="#_2-vue" class="header-anchor">#</a> 2. VUE</h2> <h3 id="_2-1-vue-基础语法"><a href="#_2-1-vue-基础语法" class="header-anchor">#</a> 2.1 Vue 基础语法</h3> <h4 id="_2-1-1-new-vue-options"><a href="#_2-1-1-new-vue-options" class="header-anchor">#</a> 2.1.1 new Vue(options)</h4> <p>创建 Vue 实例，相当于创建一个 viewModel 监听器（vm），用于监听对应视图和对应数据的相互改变。</p> <ol><li>调用_init 方法初始化事件和生命周期，对 options 做选项合并
<ul><li>initMixin(Vue)，将初始化函数_init 挂到 Vue 的原型上。</li> <li>_init(options)，将传进来的 options 赋值给 vm 上的$options，执行 initState(vm)。</li> <li>initState：总初始化函数，包括 initProps、initMethods、initData、initComputed、initWatch</li></ul></li> <li>看传进来的参数有没有 el 选项，如果有则调用$mount 来挂载模板</li></ol> <h4 id="_2-1-2-el"><a href="#_2-1-2-el" class="header-anchor">#</a> 2.1.2 el</h4> <p>指定当前 vm 所管理的视图。</p> <ul><li><p>el 不能是 body 或 html 元素。</p></li> <li><p>vue 为什么要求组件模板只能有一个根元素？</p> <ul><li>new Vue({el: '#app'})：使用浏览器 document 的 querySelector API 来获取它，而 querySelector 只会返回第一个匹配的 dom 元素。</li> <li>单文件组件 template 中根元素只能有一个：其实就是&quot;树&quot;状数据结构中的&quot;根&quot;。</li></ul></li></ul> <h4 id="_2-1-3-data"><a href="#_2-1-3-data" class="header-anchor">#</a> 2.1.3 data</h4> <p>指定当前 vm 所管理的数据。</p> <ul><li><p>为什么通过 <code>this.xxx</code> 可以直接访问到 <code>data</code> 里面的数据？</p> <ul><li>data 里的属性最终会存储到<code>vm</code>上的 <code>_data</code>对象中，访问 <code>this.xxx</code>，是访问<code>Object.defineProperty</code>代理后的 <code>this._data.xxx</code>。</li></ul></li> <li><p>data、props、methods、computed 属性名同名会怎么样？</p> <ul><li>报错，因为都会被挂载在 vm 实例上。</li> <li>键名优先级：props &gt; data &gt; methods。</li></ul></li> <li><p>vue 中怎么重置 data？</p> <ul><li>直接赋值（不推荐）</li> <li><code>this.$data = this.$options.data()</code> <ul><li><code>this.$options.data()</code>获取该组件初始状态下的 data；<code>this.$data</code>获取当前状态下的 data。</li> <li>最好使用<code>this.$options.data.call(this)</code>，解决 data 中用 this 获取的 props 或 method 为 undefined 问题。</li> <li>给某一个具体的数据 (eg: form) 重新设置值：<code>Object.assign(this.$data.form, this.$options.data().form)</code></li></ul></li></ul></li> <li><p>动态给 vue 的 data 添加一个新的属性时会发生什么？怎样解决？</p> <ul><li>受 ES5 的限制，Vue.js 不能检测到对象属性的添加或删除。因为 Vue.js 在初始化实例时将属性转为 getter/setter，所以属性必须在 data 对象上才能让 Vue.js 转换它，才能让它是响应的。</li> <li><code>Vue.set(target,key,value)</code>或<code>this.$set(target,key,value)</code> <ul><li>Vue 不允许动态添加根级响应式属性。</li></ul></li></ul></li> <li><p>为什么 data 是一个函数？</p> <ul><li>如果写成对象形式，重复创建 vue 组件实例会造成多实例共享一个数据对象，A 组件修改 data，B 组件中的 data 也会相应改变。而写成一个函数，相当于给每个组件实例返回自己的数据域，防止数据污染。</li></ul></li></ul> <h4 id="_2-1-4-props"><a href="#_2-1-4-props" class="header-anchor">#</a> 2.1.4 props</h4> <p>从父组件接收参数。</p> <ul><li>prop 验证的 type 类型有哪几种？
<ul><li>String、Number、Boolean、Array、Object、Date、Function、Symbol、自定义构造函数</li></ul></li> <li>prop 是怎么做验证的？
<ul><li>单个类型就用 Number 等基础类型；多个类型用对象，必填的话设置 require 为 true，默认值的话设置 default，对象和数组设置默认用工厂函数，自定义验证函数 validator。</li> <li>这些 prop 会在组件的实例创建之前便会进行验证，所以对于 <code>default</code>、<code>validator</code> 等函数中是访问不到组件的实例的</li></ul></li></ul> <h4 id="_2-1-5-methods"><a href="#_2-1-5-methods" class="header-anchor">#</a> 2.1.5 methods</h4> <p>存放函数，用于给别人调用。</p> <ul><li>为什么方法不能使用箭头函数？
<ul><li>方法中的 this 指向该方法所属的实例，可以使用 this 访问 data 中的属性或者其他方法；而使用了箭头函数就会丢失 this。</li></ul></li></ul> <h4 id="_2-1-6-computed"><a href="#_2-1-6-computed" class="header-anchor">#</a> 2.1.6 computed</h4> <p>存放计算属性，<strong>不是方法</strong>。</p> <p>应用场景：文本插值中逻辑过重；有明显的依赖关系。</p> <ul><li><p>computed 与 methods 区别</p> <ul><li>computed 是<strong>属性访问</strong>；methods 是<strong>函数调用</strong>；</li> <li>computed 具有<strong>缓存功能</strong>；methods 没有缓存功能。
<ul><li>computed 依赖于 data 中的数据，只有在它的相关依赖数据发生改变时才会重新求值。</li></ul></li></ul></li> <li><p>computed 与 watch 区别</p> <ul><li>computed 不支持异步；watch 支持异步；</li> <li>computed 具有缓存性，页面重新渲染值不变化，计算属性会立即返回之前的计算结果；watch 无缓存性，页面重新渲染时值不变化也会执行；</li> <li>computed 处理一个数据受多个数据影响；watch 处理一个数据影响多个数据。</li></ul></li></ul> <h4 id="_2-1-7-watch"><a href="#_2-1-7-watch" class="header-anchor">#</a> 2.1.7 watch</h4> <p>监听响应式数据的改变。监听数据必须是 data 中声明过或者父组件传递过来的 props 中的数据。</p> <p>应用场景：数据变化时执行异步操作；开销较大的操作。</p> <ul><li>watch 怎么深度监听对象变化？
<ul><li>深度监听需要配置 handler 函数以及 deep 为 true。</li></ul></li> <li>怎么在 watch 监听开始之后立即被调用？
<ul><li><code>immediate:true</code>，组件加载立即触发回调函数执行，</li></ul></li> <li>在 vue 中 watch 和 created 哪个先执行?
<ul><li>created——beforeMount——computed——mounted</li> <li>（methods——）watch——beforeUpdate——computed——updated</li></ul></li></ul> <h4 id="_2-1-8-provide-inject"><a href="#_2-1-8-provide-inject" class="header-anchor">#</a> 2.1.8 provide/inject</h4> <p>用于祖孙组件间的通信。</p> <p>provide 以对象或工厂函数返回对象（可以获取 this）方式传递数据，inject 以数组或对象（避免命名冲突）方式接收数据。</p> <h4 id="_2-1-9-filters"><a href="#_2-1-9-filters" class="header-anchor">#</a> 2.1.9 filters</h4> <p>把需要在视图中渲染的数据进行二次或者多次处理。</p> <p>可以在一个组件的选项中定义本地的过滤器，也可以在创建 vm 之前定义全局过滤器。重名用局部。过滤器中的方法没有挂载到 vm 上（不能用 this）。</p> <p>过滤器可以用在两个地方**：双花括号插值**和 <strong>v-bind 表达式</strong>；过滤器应该被添加在 JavaScript 表达式的尾部，由“｜”符号指示；过滤器函数总接收表达式的值作为第一个参数；过滤器可以串联。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 局部</span>
filters<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">addUnit</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> val<span class="token operator">+</span><span class="token string">'元/米'</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 全局</span>
Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'addUnit'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> val<span class="token operator">+</span><span class="token string">'元/米'</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_2-2-小胡子语法"><a href="#_2-2-小胡子语法" class="header-anchor">#</a> 2.2 小胡子语法</h3> <p>只能编写表达式（变量、赋值表达式、函数执行、三元表达式），不能写语句（for 循环、if 判断、switch、var 等）。</p> <p>在胡子语法中绑定的数据值是对象类型时，会基于 JSON.stringify 把其编译为字符串再呈现，而不是直接 toString。</p> <h3 id="_2-3-vue-指令"><a href="#_2-3-vue-指令" class="header-anchor">#</a> 2.3 Vue 指令</h3> <table><thead><tr><th style="text-align:center;">特性</th> <th>描述</th></tr></thead> <tbody><tr><td style="text-align:center;">v-bind</td> <td>给元素的内置属性动态绑定数据（:），如，:style 驼峰式分词，:class 样式隐藏否</td></tr> <tr><td style="text-align:center;">v-on</td> <td>监听 DOM 事件（@）</td></tr> <tr><td style="text-align:center;">v-model</td> <td>表单元素和数据的双向绑定</td></tr> <tr><td style="text-align:center;">v-for</td> <td>循环展示标签</td></tr> <tr><td style="text-align:center;">v-if / v-else-if / v-else</td> <td>控制标签元素（每次都会删除或创建元素，会引起回流）</td></tr> <tr><td style="text-align:center;">v-show</td> <td>控制标签元素（本质是通过设置标签属性 display 为 none）</td></tr> <tr><td style="text-align:center;">v-text</td> <td>给非表单元素设置内容，相当于小胡子语法，但会替换掉节点内已有内容</td></tr> <tr><td style="text-align:center;">v-html</td> <td>给非表单元素设置内容，相当于 innerHTML</td></tr> <tr><td style="text-align:center;">v-slot</td> <td>插槽：作用域插槽：</td></tr> <tr><td style="text-align:center;">v-pre</td> <td>跳过这个元素和子元素的编译过程，原样输出。</td></tr> <tr><td style="text-align:center;">v-cloak</td> <td>为了解决小胡子的显示问题，搭配 css 解决屏幕闪动问题，当模板渲染完这个指令移除。</td></tr> <tr><td style="text-align:center;">v-once</td> <td>元素只渲染一次</td></tr></tbody></table> <p><strong>v-if 和 v-show 的区别</strong>：</p> <ul><li>v-if 本质是动态的向 DOM 树内添加或者删除 DOM 元素，开销大；v-show 本质就是通过设置标签属性 display 为 none 来控制隐藏，开销小。</li> <li>v-if 适用于在运行时很少改变条件，不需要频繁切换条件的场景；v-show 适用于需要非常频繁切换条件的场景。</li></ul> <p><strong>v-for 和 v-if 不能同时使用</strong>：</p> <ul><li><code>v-for</code>比<code>v-if</code>优先级高，同时使用会遍历数组的每一项，然后再判断 v-if，这样会导致一些不必要的计算，浪费性能，所以一般在 computed 中先对数组进行过滤再使用。</li></ul> <p><strong>v-for 遍历对象</strong>：</p> <ul><li>先判断是否有 iterator 接口，如果有循环执行 next()方法</li> <li>没有 iterator 的情况下，会调用 Object.keys()方法，在不同浏览器中，JS 引擎不能保证输出顺序一致</li></ul> <p><strong>v-model 原理</strong>：</p> <ul><li>本质是语法糖：v-model=&quot;foo&quot; 就是 :value=&quot;foo&quot; @input=&quot;foo = $event&quot;，</li> <li>定义在表单元素上：把数据绑定给表单元素，然后监听表单元素的内容改变。
<ul><li>v-model 在内部为不同的输入元素使用不同的 property 并抛出不同的事件：
<ul><li>text 和 textarea 使用 value property 和 input 事件；</li> <li>checkbox 和 radio 使用 checked property 和 change 事件；</li> <li>select 使用 value property 和 change 事件。</li></ul></li></ul></li> <li>定义在组件上：给子组件传递一个 props，监听子组件上的事件；子组件抛出事件，通知父组件自行改变绑定的值。
<ul><li><code>v-model</code> 做法完全符合单向数据流，【数据向下，事件向上】。</li></ul></li></ul> <p><strong>class 和 style 绑定</strong>：</p> <ul><li>:class=&quot;{样式类名:响应式数据,...}&quot;，响应式数据为 true 则有这个样式。对象可以直接写在结构上、写在响应数据中、写在计算属性中。</li> <li>:class=&quot;[响应式数据 1,...]&quot;，响应式数据的值为样式类。</li> <li>:style 与 class 基本一样，可以用驼峰式或者短线分割来命名。</li></ul> <p><strong>slot 插槽</strong>：</p> <ul><li>插槽，相当于占位符。在组件模板中占好了位置，当使用该组件标签时候，组件标签里面的内容就会自动填坑（替换组件模板中<code>slot</code>位置）。抽取共性、保留不同。</li> <li>作用：让组件可以自定义扩展内容。</li> <li>应用：通用的导航组件（左中右区域内容不固定）</li> <li>匿名插槽</li> <li>具名插槽：在模版中给预留的插槽设置名字。v-slot:xxx 相当于 slot=&quot;xxx&quot;，同时标签改为 template。</li> <li>作用域插槽：解决不能在插槽中直接使用组件中私有的响应式数据问题。子组件 v-bind 绑定数据，父组件 v-slot=&quot;slotProps&quot;，slotProps.xxx 访问。</li></ul> <p><strong>自定义指令</strong>：</p> <ul><li><p>指令本质上是装饰器，是 vue 对 HTML 元素的扩展，给 HTML 元素增加自定义功能。vue 编译 DOM 时，会找到指令对象，执行指令的相关方法。</p></li> <li><p>自定义指令有五个生命周期函数</p> <ul><li>bind：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。</li> <li>inserted：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</li> <li>update：被绑定于元素所在的模板更新时调用，而无论绑定值是否变化。通过比较更新前后的绑定值，可以忽略不必要的模板更新。</li> <li>componentUpdated：被绑定元素所在模板完成一次更新周期时调用。</li></ul> <ol start="5"><li>unbind：只调用一次，指令与元素解绑时调用。</li></ol></li> <li><p>函数参数</p> <ul><li><p>el：指令所绑定的元素，可以用来直接操作 DOM。</p></li> <li><p>binding： 里面包含事件信息</p> <ul><li>value：绑定的值</li> <li>oldValue：绑定前的值</li></ul></li> <li><p>vnode：Vue 编译生成的虚拟节点。</p></li> <li><p>oldNode：上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。</p></li></ul></li> <li><p><strong>原理</strong></p> <ul><li>在生成 ast 语法树时，遇到指令会给当前元素添加 directives 属性</li> <li>通过 genDirectives 生成指令代码</li> <li>在 patch 前将指令的钩子提取到 cbs 中，在 patch 过程中调用对应的钩子</li> <li>当执行指令对应钩子函数时，调用对应指令定义的方法</li></ul></li></ul> <h3 id="_2-4-修饰符"><a href="#_2-4-修饰符" class="header-anchor">#</a> 2.4 修饰符</h3> <p><strong>事件修饰符</strong> @事件.修饰符</p> <ul><li>.stop 阻止冒泡传播</li> <li>.capture 控制函数在捕获阶段执行</li> <li>.self 只有点击元素本身才会触发这个函数</li> <li>.once 事件只会触发一次</li> <li>.prevent 阻止默认行为</li> <li>.passive 先执行默认，后执行函数（如移动端滚动事件）</li> <li>.native 加在自定义组件的事件上，保证事件能执行</li> <li>.sync 事件绑定的语法糖，在父子组件传值且子组件要修改这个数据时使用。
<ul><li><code>&lt;Child :money=&quot;total&quot; v-on:update:money=&quot;total = $event&quot;/&gt;</code> 相当于<code>&lt;Child :money.sync=&quot;total&quot;/&gt;</code>，子组件内必须用<code>'update:money'</code>事件名去触发响应<code>&lt;button @click=&quot;$emit('update:money', money-100)&quot;&gt;</code>。</li> <li>不能用表达式，否则会导致 Invalid left-hand side in assignment。</li></ul></li></ul> <p><strong>键盘事件的修饰符</strong> @keydown.修饰符</p> <ul><li>.enter</li> <li>.tab</li> <li>.delete (捕获“删除”和“退格”键)</li> <li>.esc</li> <li>.space</li> <li>.up</li> <li>.down</li> <li>.left</li> <li>.right</li></ul> <p><strong>系统修饰键</strong></p> <ul><li>.ctrl</li> <li>.alt</li> <li>.shift</li> <li>.meta</li></ul> <p><strong>鼠标按钮修饰符</strong></p> <ul><li>.left</li> <li>.right</li> <li>.middle</li></ul> <p><strong>v-model 的修饰符</strong></p> <ul><li>.lazy 会在 change 事件触发的时候去监听，如在光标离开 input 框才会更新数据</li> <li>.number 自动将用户的输入值转化为数值类型。先输入数字的话，只取前面数字部分，先输入字母的话，修饰符无效。</li> <li>.trim 自动过滤用户输入的首尾空格</li></ul> <h2 id="_3-vue-生命周期"><a href="#_3-vue-生命周期" class="header-anchor">#</a> 3. VUE 生命周期</h2> <p>Vue 的生命周期指的是组件从创建到销毁的一系列的过程。</p> <p>作用：在渲染的每一个关键节点上，提供对应的函数，让我们进行一些相关操作。</p> <p>生命周期函数 = 生命周期钩子 = 生命周期事件</p> <h3 id="_3-1-vue2-0-生命周期"><a href="#_3-1-vue2-0-生命周期" class="header-anchor">#</a> 3.1 Vue2.0 生命周期</h3> <p><strong>实例创建阶段</strong>：</p> <ul><li><p><code>new Vue()</code>：准备创建一个 Vue 实例对象，让这个实例完成双向处理操作。</p></li> <li><p>Init1：初始化事件和生命周期函数。</p></li> <li><p><strong><code>beforeCreate</code></strong>：</p> <ul><li>创建实例之前，data 和 methods 中的数据都还没有被初始化。</li> <li>组件是否渲染的权限校验。</li></ul></li> <li><p>Init2：初始化 data、methods、filter 等数据的处理。</p></li> <li><p><strong><code>created</code></strong>：</p> <ul><li>实例创建完成，data、methods 等已经挂载到实例上了。</li> <li>发送异步数据请求。</li></ul></li> <li><p>分支判断：开始编译模板，执行 Vue 代码中的指令，在内存中生成一个编译好的模板字符串。</p></li> <li><p><strong><code>beforeMount</code></strong>：</p> <ul><li>第一次渲染 DOM 之前，此时页面中还没有 DOM 元素。</li> <li>基本不做啥，或发送异步数据请求。</li></ul></li> <li><p>虚拟 DOM 转化为真实 DOM，并渲染到页面。</p></li> <li><p><strong><code>mounted</code></strong>：</p> <ul><li>真实 DOM 渲染完了。</li> <li>DOM 处理或者监听。</li></ul></li></ul> <p><strong>运行阶段</strong>：</p> <ul><li><p><strong><code>beforeUpdate</code></strong>：</p> <ul><li>此时 data 数据是最新的，页面尚末和最新的数据保持同步。</li> <li>基本不做啥。</li></ul></li> <li><p>根据 data 中最新的数据，在内存中重新构建虚拟 DOM，与上一次虚拟 DOM 比较（diff 算法），然后再渲染到页面中去（回流），完成了数据从 data(Model)到 View 的更新。</p></li> <li><p><strong><code>updated</code></strong>：</p> <ul><li>页面和 data 数据已经保持同步了，都是最新的。</li> <li>DOM 处理或者监听。不能修改响应数据（会死循环！）。</li></ul></li></ul> <p><strong>销毁阶段</strong>：</p> <ul><li><p><strong><code>beforeDestroy</code></strong>：</p> <ul><li>销毁之前。</li> <li>保存、提示。</li></ul></li> <li><p>销毁的时候，页面已经渲染的真实 DOM 不动（路由跳转除外），其他之前挂在的东西都消失了。</p></li> <li><p><strong><code>destroyed</code></strong>：</p> <ul><li>销毁之后。</li> <li>基本不做啥。</li></ul></li></ul> <img src="\imgs\vue生命周期备注图.png" style="zoom:70%;"> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3 id<span class="token operator">=</span><span class="token string">&quot;h3&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;修改msg&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;msg='No'&quot;</span><span class="token operator">&gt;</span>

            <span class="token punctuation">{</span><span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;js/vue.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">{</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;yes&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            methods<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行了show方法'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

            <span class="token comment">// 1. 实例创建阶段</span>
            <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// data 和 methods中的数据都还没有初始化</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// data和methods已经被初始化好了</span>
                <span class="token comment">// 如果要调用methods中的方法，或者操作data中的数据，最早，只能在created中操作</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              	<span class="token comment">// 模板在内存中编辑完成，但是没有渲染到页面中</span>
                <span class="token comment">// 在beforeMount执行的时候，页面中的元素，还没有被真正替换过来，只是之前的一些模板字符串</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 内存中的模板，已经挂载到页面中，用户可以看到</span>
                <span class="token comment">// 当执行完mounted就表示实例已经被完全创建好了</span>
              	<span class="token comment">// 此时如果没有其它操作的话，这个实例就静静的躺在我们的内存中</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

          	<span class="token comment">// 2. 运行阶段：会根据data数据的改变，有选择性地触发0到多次</span>
            <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              	<span class="token comment">// 此时data数据是最新的，页面尚末和最新的数据保持同步。</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'界面上元素的内容：'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data中的msg数据是：'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              	<span class="token comment">// 页面和data数据已经保持同步了，都是最新的。</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'界面上元素的内容：'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data中的msg数据是：'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

            <span class="token comment">// 3. 销毁阶段：页面关闭等操作</span>
            <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 实例身上所有的data、methods、过滤器、指令...都处于可用状态，此时，还没有真正执行销毁过程。</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 组件已经完全被销毁了，此时组件中所有的data、methods、过滤器、指令...都已经被销毁了。</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p><strong>keep-alive 相关的生命周期钩子函数</strong>：</p> <ul><li>activated： keep-alive 组件激活时触发</li> <li>deactivated：keep-alive 组件停用时触发</li></ul> <h3 id="_3-2-vue3-0-生命周期"><a href="#_3-2-vue3-0-生命周期" class="header-anchor">#</a> 3.2 Vue3.0 生命周期</h3> <ol><li><p>在<strong>组合 API</strong>中使用 Vue 3 生命周期钩子，需要将生命周期钩子导入到项目中才能使用。</p></li> <li><p>销毁生命周期钩子改名</p> <ul><li><p>beforeDestroy -&gt; beforeUnmount</p></li> <li><p>destroyed -&gt; unmounted</p></li></ul></li> <li><p>被替换</p> <ul><li><p><code>beforeCreate</code> -&gt; 使用 <code>setup()</code></p></li> <li><p><code>created</code> -&gt; 使用 <code>setup()</code></p></li></ul></li> <li><p>重命名</p> <ul><li><p><code>beforeMount</code> -&gt; <code>onBeforeMount</code></p></li> <li><p><code>mounted</code> -&gt; <code>onMounted</code></p></li> <li><p><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></p></li> <li><p><code>updated</code> -&gt; <code>onUpdated</code></p></li> <li><p><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code></p></li> <li><p><code>destroyed</code> -&gt; <code>onUnmounted</code></p></li> <li><p><code>activated</code> -&gt; <code>onActivated</code></p></li> <li><p><code>deactivated</code> -&gt; <code>onDeactivated</code></p></li> <li><p><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></p></li></ul></li> <li><p>Vue3 为我们提供了两个可用于调试的钩子</p> <ul><li><code>onRenderTracked</code>：状态跟踪
<ul><li>它会跟踪页面上所有响应式变量和方法的状态，也就是我们用<code>return</code>返回去的值。只要页面有<code>update</code>的情况，它就会跟踪，然后生成一个<code>event</code>对象，我们通过<code>event</code>对象来查找程序的问题所在。</li></ul></li> <li><code>onRenderTriggered</code>：状态触发
<ul><li>它不会跟踪每一个值，而是给你变化值的信息，并且新值和旧值都会给你明确的展示出来</li> <li>event 对象
<ul><li>key：哪边变量发生了变化</li> <li>newValue：更新后变量的值</li> <li>oldValue：更新前变量的值</li> <li>target：目前页面中的响应变量和函数</li></ul></li></ul></li></ul></li></ol> <h3 id="_3-3-父子组件生命周期"><a href="#_3-3-父子组件生命周期" class="header-anchor">#</a> 3.3 父子组件生命周期</h3> <ul><li><p><strong>加载渲染过程（父等子 mounted）</strong></p> <p>父 beforeCreate -&gt; 父 created -&gt; 父 beforeMount -&gt; 子 beforeCreate -&gt; 子 created -&gt; 子 beforeMount -&gt; 子 mounted -&gt; 父 mounted</p></li> <li><p><strong>子组件更新过程（父等子 update）</strong></p> <p>父 beforeUpdate -&gt; 子 beforeUpdate -&gt; 子 updated -&gt; 父 updated</p></li> <li><p><strong>销毁过程（父等子 destroyed）</strong></p> <p>父 beforeDestroy -&gt; 子 beforeDestroy -&gt; 子 destroyed -&gt; 父 destroyed</p></li></ul> <h3 id="_3-4-父组件监听子组件的生命周期"><a href="#_3-4-父组件监听子组件的生命周期" class="header-anchor">#</a> 3.4 父组件监听子组件的生命周期</h3> <p><strong>1、使用 on 和 emit</strong></p> <p>子组件 emit 触发一个事件，父组件 on 监听相应事件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Parent.vue</span>
<span class="token operator">&lt;</span>Child @mounted<span class="token operator">=</span><span class="token string">&quot;doSomething&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件监听到子组件的 mounted 钩子函数 ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// Child.vue</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;mounted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>2、hook 钩子函数</strong></p> <p>子组件不需要任何处理，只需要在父组件引用的时候通过<code>@hook</code>来监听即可：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//  Parent.vue</span>
<span class="token operator">&lt;</span>Child @hook<span class="token operator">:</span>mounted<span class="token operator">=</span><span class="token string">&quot;doSomething&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">&gt;</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件监听到子组件的 mounted 钩子函数 ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">//  Child.vue</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'子组件触发 mounted 钩子函数 ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 以上输出顺序为：</span>
<span class="token comment">// 子组件触发 mounted 钩子函数 ...</span>
<span class="token comment">// 父组件监听到子组件的 mounted 钩子函数 ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_4-双向数据绑定"><a href="#_4-双向数据绑定" class="header-anchor">#</a> 4. 双向数据绑定</h2> <h3 id="_4-1-架构模式"><a href="#_4-1-架构模式" class="header-anchor">#</a> 4.1 架构模式</h3> <h4 id="_4-1-mvc"><a href="#_4-1-mvc" class="header-anchor">#</a> 4.1 MVC</h4> <p><strong>MVC</strong>：</p> <ul><li>模型（Model）：数据保存；</li> <li>视图（View）：用户界面；</li> <li>控制器（Controller）：业务逻辑</li></ul> <p><strong>特点</strong>：</p> <ul><li>所有通信都是单向的。</li> <li>View 把指令传给 Controller；Controller 完成业务逻辑操作后， 改变 Model 状态；Model 将新的数据发送到 View，用户得到反馈。</li> <li><strong>两种接收指令的方式</strong>：1. View 传送指令到 Controller；2. 用户直接将指令传到 Controller。</li></ul> <p><strong>优点</strong>：</p> <ul><li>把业务逻辑全部分离到 Controller 中，模块化程度高。当业务逻辑变更的时候，不需要变更 View 和 Model，只需要 Controller 换成另外一个 Controller 就行了。</li></ul> <p><strong>缺点</strong>：</p> <ul><li>Controller 测试困难。</li> <li>View 和 Model 之间存在耦合，View 无法组件化。</li></ul> <p><strong>应用</strong>：</p> <ul><li>Backbone.js</li></ul> <img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015020105.png" alt="img" style="zoom:60%;"> <h4 id="_4-2-mvp"><a href="#_4-2-mvp" class="header-anchor">#</a> 4.2 MVP</h4> <p><strong>MVP</strong>：</p> <ul><li>Presenter：View 和 Model 的中间枢纽，处理和用户交互的逻辑。</li></ul> <p><strong>特点</strong>：</p> <ol><li>各部分之间的通信都是双向的。</li> <li>View 与 Model 不发生联系，都通过 Presenter 传递。</li> <li>View 接受用户请求并传递给 Presenter，Presenter 做逻辑处理并修改 Model，Model 通知 Presenter 数据变化，Presenter 更新 View。</li> <li>View 非常薄，不部署任何业务逻辑，称为&quot;被动视图&quot;（Passive View），即没有任何主动性，而 Presenter 非常厚，所有逻辑都部署在那里。</li></ol> <p><strong>优点</strong>：</p> <ul><li><p>便于测试。</p></li> <li><p>View 和 Model 解耦，View 可以进行组件化。</p></li></ul> <p><strong>缺点</strong>：</p> <ul><li><p>View 需要持有 Presenter 的引用，同时，Presenter 也需要持有 View 的引用，增加了控制的复杂度，一旦视图变更了，Presenter 也要变更。</p></li> <li><p>Presenter 中除了业务逻辑以外，还有大量的 View-&gt;Model，Model-&gt;View 的手动同步逻辑，造成 Presenter 笨重，维护困难。</p></li></ul> <img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015020109.png" alt="img" style="zoom:60%;"> <h4 id="_4-3-mvvm"><a href="#_4-3-mvvm" class="header-anchor">#</a> 4.3 MVVM</h4> <p><strong>MVVM</strong>：</p> <ul><li><strong>ViewModel，</strong> 监听模型数据的改变和控制试图行为、处理用户交互、简单理解就是一个同步 View 和 Model 的对象，连接 Model 和 View。</li></ul> <p><strong>特点</strong>：</p> <ul><li><p>ViewModel 层和 View 层采用双向绑定的形式（Binding），View 层的变动，将自动反映在 ViewModel 层，反之亦然。</p></li> <li><p>View 接收用户交互请求并转交给 ViewModel，ViewModel 操作 Model 数据更新，Model 更新完数据，通知 ViewModel 数据发生变化</p> <p>ViewModel 更新 View 数据。</p></li></ul> <p><strong>优点</strong>：</p> <ul><li>通过双向绑定机制解决了 MVP 大量的手动 View 和 Model 同步的问题，提高了代码的可维护性。</li></ul> <p><strong>缺点</strong>：</p> <ul><li>数据绑定使得一个位置的 Bug 被快速传递到别的位置，问题的定位变得困难。</li> <li>对于大型的图形应用程序，视图状态较多，ViewModel 的构建和维护的成本都会比较高。</li> <li>一个模块中 model 很大的情况下，如果长期持有不释放内存会造成内存泄漏。</li></ul> <p><strong>应用</strong>：</p> <ul><li>AngularJs、EmberJs、VueJs</li></ul> <img src="https://www.ruanyifeng.com/blogimg/asset/2015/bg2015020110.png" alt="img" style="zoom:60%;"> <p><strong>MVVM 和 MVC 区别</strong>：</p> <ul><li>MVC 中 Controller 演变成 MVVM 中的 ViewModel</li> <li>MVVM 通过数据来显示视图层，并采用数据双向绑定原理，MVC 是通过 Controller 来进行节点的操作</li> <li>MVVM 主要解决了 MVC 中大量的 dom 操作使页面渲染性能降低，加载速度变慢，影响用户体验</li></ul> <p><strong>MVVM 和 MVP 区别</strong>：</p> <ul><li>MVVM 采用数据双向绑定：View 的变化会自动反映在 ViewModel，反之亦然；而 MVP 需要 Presenter 手动同步 View 和 Model。</li></ul> <p><strong>Vue 的 MVVM</strong>：包括 数据绑定 和 DOM 监听，数据绑定把数据放在了视图中我们指定的位置上，以后数据无论怎么变化，页面上的数据就会自动更新，无需我们手动进行 DOM 操作；DOM 监听则是监听页面上的 DOM 改变，然后映射回数据当中。</p> <h3 id="_4-2-数据到视图绑定"><a href="#_4-2-数据到视图绑定" class="header-anchor">#</a> 4.2 数据到视图绑定</h3> <h4 id="_4-2-1-原理"><a href="#_4-2-1-原理" class="header-anchor">#</a> 4.2.1 原理</h4> <p><strong>数据响应式</strong>：数据发生变化后，会重新渲染页面。</p> <p><strong>原理</strong>：</p> <ul><li><p>Vue 在实例化时会对 data 上的数据进行递归生成 Observer 实例对象和 Dep 实例对象。在 observer 这个过程中给每一项对象通过<code>Object.defineProperty</code>进行数据劫持（给对象的属性添加 getter 和 setter）。在 getter 中收集依赖，在 setter 中触发依赖。</p></li> <li><p>解析模板指令，将模板中的变量替换成数据，初始化渲染视图；然后创建 Watcher 实例，传入当前指令对应节点的更新函数；在 Watcher 实例化的时候会进行依赖收集，触发 getter，使得 dep 对象的 subs 数组中存放了对应的 watcher 实例，当数据发生变化时，会触发 setter，dep 会通知 subs 数组中的 watcher 实例进行更新渲染。</p></li></ul> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/64661fd2e47e4582bdd388c1b29b845f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img" style="zoom:50%;"> <p><strong>实现目标</strong>：</p> <ul><li>侦测数据的变化（数据劫持 / 数据代理）</li> <li>收集视图依赖了哪些数据（依赖收集）</li> <li>数据变化时，自动“通知”需要更新的视图部分，并进行更新（发布订阅模式）</li></ul> <h4 id="_4-2-2-数据劫持"><a href="#_4-2-2-数据劫持" class="header-anchor">#</a> 4.2.2 数据劫持</h4> <p>数据劫持是对属性的读取和修改进行拦截，简单来说就是侦测数据的变化，这样才能根据数据变化做对应操作。</p> <h5 id="_4-2-2-1-object-defineproperty"><a href="#_4-2-2-1-object-defineproperty" class="header-anchor">#</a> 4.2.2.1 Object.defineProperty</h5> <p><strong>作用</strong>：在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回这个对象。</p> <p><strong>语法</strong>：<code>Object.defineProperty(obj, prop, descriptor)</code></p> <ul><li>obj: 要在其上定义属性的对象。</li> <li>prop: 要定义或修改的属性的名称。</li> <li>descriptor: 将被定义或修改的属性的描述符。
<ul><li>数据描述符：
<ul><li>[[Configurable]]：表示能否通过 delete 删除属性从而重新定义属性，能否修改属性的描述符，或者能否把属性修改为存取描述符。默认为 false。</li> <li>[[Enumerable]]：表示能否通过 for-in 循环返回属性。默认为 false。</li> <li>[[Writable]]：表示能否修改属性的值。默认为 undefined。</li> <li>[[Value]]：包含这个属性的数据值。读取属性值的时候，从这个位置读；写入属性值的时候，把新值保存在这个位置。默认为 undefined。</li></ul></li> <li>存取描述符：
<ul><li>[[Configurable]]：表示能否通过 delete 删除属性从而重新定义属性，能否修改属性的特性，或者能否把属性修改为数据属性。对于直接在对象上定义的属性，这个特性的默认值为 true。</li> <li>[[Enumerable]]：表示能否通过 for-in 循环返回属性。对于直接在对象上定义的属性，这个特性的默认值为 true。</li> <li>[[Get]]：在读取属性时调用的函数。默认为 undefined。</li> <li>[[Set]]：在写入属性时调用的函数。默认为 undefined。</li></ul></li></ul></li></ul> <p><strong>缺点</strong>：</p> <ul><li><p>无法检测到对象属性的添加或删除</p> <ul><li><p>Vue.set、vm.$set、vm.$delete</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 向嵌套对象添加响应式属性</span>
Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// vm.$set 实例方法，是全局 Vue.set 方法的别名</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>给这个对象重新赋值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 添加多个对象属性</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>someObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p>无法监听数组的变化（当利用索引直接设置一个数组项时、当修改数组的长度时、使用数组的方法）</p> <ul><li><p>Vue.set、vm.$set</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span> indexOfItem<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
vm<span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span> indexOfItem<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>indexOfItem<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>newLength<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>重写数组方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">def</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enumerable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">,</span>
    enumerable<span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 得到Array.prototype</span>
<span class="token keyword">const</span> arrayPrototype <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype

<span class="token comment">// 以Array.prototype为原型创建arrayMethods对象，并暴露</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayPrototype<span class="token punctuation">)</span>

<span class="token comment">// 要被改写的7个数组方法</span>
<span class="token keyword">const</span> methodsNeedChange <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'shift'</span><span class="token punctuation">,</span> <span class="token string">'unshift'</span><span class="token punctuation">,</span> <span class="token string">'splice'</span><span class="token punctuation">,</span> <span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token string">'reverse'</span><span class="token punctuation">]</span>

methodsNeedChange<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">methodName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 备份原来的方法，因为push、pop等7个函数的功能不能被剥夺</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayPrototype<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span>
  <span class="token comment">// 定义新的方法</span>
  <span class="token function">def</span><span class="token punctuation">(</span>
    arrayMethods<span class="token punctuation">,</span>
    methodName<span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 恢复原来的功能</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
      <span class="token comment">// 把类数组对象变为数组</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span>
      <span class="token comment">// 把这个数组身上的__ob__取出来，__ob__已经被添加了。</span>
      <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__

      <span class="token comment">// 有三种方法push\unshift\splice能够插入新项，现在要把插入的新项也要变为observe的</span>
      <span class="token keyword">let</span> inserted <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

      <span class="token keyword">switch</span> <span class="token punctuation">(</span>methodName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
          inserted <span class="token operator">=</span> args
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
          <span class="token comment">// splice格式是splice(下标, 数量, 插入的新项)</span>
          inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
          <span class="token keyword">break</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 判断有没有要插入的新项，让新项也变为响应的</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div></li></ul></li></ul> <p>ps**：Vue.set()和 this.$set()区别**：将 Vue.set()函数绑定在 Vue 构造函数；将 this.$set()函数绑定在 Vue 原型上。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 核心代码</span>
<span class="token keyword">function</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> data <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 递归子属性</span>
  <span class="token function">observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果赋值是一个对象，也要递归子属性</span>
      <span class="token function">observer</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">!==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> newValue
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="_4-2-2-2-proxy"><a href="#_4-2-2-2-proxy" class="header-anchor">#</a> 4.2.2.2 Proxy</h5> <p><strong>作用</strong>：提供了一种机制可以对外界的访问进行过滤和改写，修改某些操作的默认行为。Proxy 的代理是针对整个对象的，而不是对象的某个属性。</p> <p><strong>语法</strong>：<code>new Proxy(target, handler)</code></p> <ul><li><code>target</code>：拦截的目标对象</li> <li><code>handler</code>：定制拦截行为的对象</li></ul> <p><strong>优点</strong>：</p> <ul><li>proxy 可以监听对象而非属性，并返回一个新对象（proxy 可以直接监听数组的变化）。</li> <li>除了 get 和 set，proxy 有多达 13 种的拦截方法。速度加倍、内存减半。</li></ul> <p><strong>缺点</strong>：</p> <ul><li>兼容性：Proxy 对 IE 不友好
<ul><li>vue3 在检测到使用 IE 的情况下（包括 IE11），会自动降级为 Object.defineProperty 。</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'模拟视图渲染'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果取的值是对象就在对这个对象进行数据劫持</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'length'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'前端工匠'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span>age<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'浪里行舟'</span> <span class="token comment">// 支持新增属性 模拟视图的更新</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>age<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 浪里行舟</span>
proxy<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'浪里行舟'</span> <span class="token comment">//支持数组的内容发生变化 模拟视图的更新</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>arr<span class="token punctuation">)</span> <span class="token comment">// ['浪里行舟', 2, 3 ]</span>
proxy<span class="token punctuation">.</span>arr<span class="token punctuation">.</span>length<span class="token operator">--</span> <span class="token comment">// 无效</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>arr<span class="token punctuation">)</span> <span class="token comment">// [ '浪里行舟', 2, 3 ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_4-3-视图到数据绑定"><a href="#_4-3-视图到数据绑定" class="header-anchor">#</a> 4.3 视图到数据绑定</h3> <p>v-model：把数据绑定给表单元素，然后<strong>监听表单内容改变（事件绑定）</strong>。在事件处理函数中，把表单最新值赋值给数据，触发 setter，通知 watcher 更新渲染视图。</p> <h3 id="_4-4-实现"><a href="#_4-4-实现" class="header-anchor">#</a> 4.4 实现</h3> <h4 id="_4-4-1-observer"><a href="#_4-4-1-observer" class="header-anchor">#</a> 4.4.1 Observer</h4> <p>作用：利用 Object.defineProperty 给对象的属性添加 getter 和 setter**。在 getter 中收集依赖，在 setter 中触发依赖**。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* observer.js */</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token comment">// 遍历 data 转为响应式</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 添加 Watcher 实例</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
        <span class="token keyword">return</span> value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span>
        value <span class="token operator">=</span> newValue
        self<span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
        dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="_4-4-2-compiler"><a href="#_4-4-2-compiler" class="header-anchor">#</a> 4.4.2 Compiler</h4> <p>作用：解析 Vue 模板指令，将模板中的变量替换成数据，初始化渲染视图；然后创建 Watcher 实例，传入当前指令对应节点的更新函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* compiler.js */</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> vm<span class="token punctuation">.</span>$el
    <span class="token comment">// 编译模板</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建文档碎片，提高 DOM 操作的性能</span>
    <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> childNode <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>childNode <span class="token operator">=</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childNode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 进行模板替换</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
    el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">replace</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义匹配插值表达式的正则</span>
    <span class="token keyword">const</span> regMustache <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{\s*(\S+)\s*\}\}</span><span class="token regex-delimiter">/</span></span>

    <span class="token comment">// 当前的 node 节点是一个文本子节点，需要进行正则的替换</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent
      <span class="token keyword">const</span> execResult <span class="token operator">=</span> regMustache<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>execResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> execResult<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newObj<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newObj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
        node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regMustache<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token comment">// 创建 Watcher 类的实例</span>
        <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token parameter">newValue</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regMustache<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 当前的 node 节点是 input 输入框</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'INPUT'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 得到当前元素的所有属性节点</span>
      <span class="token keyword">const</span> attrs <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
      <span class="token comment">// 找是否存在 v-model 属性</span>
      <span class="token keyword">const</span> findResult <span class="token operator">=</span> attrs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'v-model'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>findResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取到当前 v-model 属性的值, v-model=&quot;info.a&quot;</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> findResult<span class="token punctuation">.</span>value
        <span class="token keyword">const</span> value <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newObj<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newObj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
        node<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token comment">// 创建 Watcher 的实例</span>
        <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token parameter">newValue</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 监听文本框的 input 输入事件，拿到文本框最新的值，把最新的值，更新到 vm 上</span>
        node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> keyArr <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> obj <span class="token operator">=</span> keyArr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> keyArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newObj<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newObj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
          <span class="token comment">// 触发 setter</span>
          obj<span class="token punctuation">[</span>keyArr<span class="token punctuation">[</span>keyArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h4 id="_4-4-3-dep"><a href="#_4-4-3-dep" class="header-anchor">#</a> 4.4.3 Dep</h4> <p>作用：依赖管理，用于收集当前响应式对象的依赖关系，每个响应式对象包括子对象都拥有一个 Dep 实例（里面 subs 是 Watcher 实例数组），当数据有变更时，会通过 dep.notify()通知各个 watcher。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* dep.js */</span>
<span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储观察者</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 添加观察者</span>
  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher <span class="token operator">&amp;&amp;</span> watcher<span class="token punctuation">.</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 通知方法</span>
  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">watcher</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_4-4-4-watcher"><a href="#_4-4-4-watcher" class="header-anchor">#</a> 4.4.4 Watcher</h4> <p>作用：每个依赖会生成一个 Watcher 实例，在执行构造函数的时候将 <code>Dep.target</code> 指向自身，触发 get 劫持使得 Dep 实例收集到了对应的 Watcher，在派发更新的时候取出对应的 Watcher ，然后执行 <code>update</code> 函数（触发解析器 compile 中对应的更新函数）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* watcher.js */</span>
<span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token comment">// 把创建的 Watcher 实例存到 Dep 实例的 subs 数组中</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newObj<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newObj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span> <span class="token comment">// 触发 getter</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 观察者中的必备方法,用来更新视图</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newObj<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newObj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_4-4-5-vue"><a href="#_4-4-5-vue" class="header-anchor">#</a> 4.4.5 Vue</h4> <p>作用：获取 options，属性代理，数据劫持，模版编译。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* vue.js */</span>
<span class="token keyword">class</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 options</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// 获取 el</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>el <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>el
    <span class="token comment">// 获取 data</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$data <span class="token operator">=</span> options<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// 属性代理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_proxyData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span>
    <span class="token comment">// 数据劫持</span>
    <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span>
    <span class="token comment">// 模板编译</span>
    <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">_proxyData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
          data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_4-4-6-index"><a href="#_4-4-6-index" class="header-anchor">#</a> 4.4.6 index</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>vue双向数据绑定原理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>姓名是：{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>年龄是：{{ age }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>info.a的值是：{{info.a}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        name的值：
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        info.a的值：
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>info.a<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dep.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./watcher.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./compiler.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./observer.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'lanyu'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          info<span class="token operator">:</span> <span class="token punctuation">{</span>
            a<span class="token operator">:</span> <span class="token string">'a1'</span><span class="token punctuation">,</span>
            c<span class="token operator">:</span> <span class="token string">'c1'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="_5-组件通信"><a href="#_5-组件通信" class="header-anchor">#</a> 5. 组件通信</h2> <h3 id="_5-1-父-子"><a href="#_5-1-父-子" class="header-anchor">#</a> 5.1 父--&gt;子</h3> <ul><li><strong>props</strong>：父组件通过标签特性传递给子组件，子组件通过 props 来获取</li> <li><strong>provide / inject</strong>：父组件通过 provider 传递数据，子组件通过 inject 来获取</li> <li><strong>$attrs / $listeners</strong>：子组件通过 v-bind 绑定<code>$attrs</code>，其中包含着不被 prop 识别的父组件传递过来的数据。通过 v-on 绑定<code>$listeners</code>将事件传递给子组件。</li> <li><strong>$parent</strong>：父组件的实例对象</li></ul> <h5 id="_1-props"><a href="#_1-props" class="header-anchor">#</a> 1）props</h5> <p>父组件在子组件标签特性里将数据值传递给 prop，子组件通过 props 属性定义的 prop 列表，从而让子组件可访问这个值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 父：传递list</span>
<span class="token operator">&lt;</span>com<span class="token operator">-</span>article <span class="token operator">:</span>alist<span class="token operator">=</span><span class="token string">&quot;list&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>com<span class="token operator">-</span>article<span class="token operator">&gt;</span>
<span class="token comment">// 子</span>
props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'alist'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="_2-provide-inject"><a href="#_2-provide-inject" class="header-anchor">#</a> 2）provide / inject</h5> <p>在父组件中通过 <code>provider</code> 来提供属性，然后在子组件（子孙组件）中通过 <code>inject</code> 来注入变量。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 父：传递list</span>
provide<span class="token operator">:</span> <span class="token punctuation">{</span>
  list<span class="token operator">:</span> <span class="token string">'test'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 子/子孙</span>
inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_3-attrs-listeners"><a href="#_3-attrs-listeners" class="header-anchor">#</a> 3）$attrs / $listeners</h5> <p>子组件中的<code>$attrs</code>包含了父组件组件中不被 prop 所识别的特性绑定，使用 v-bind 绑定 <code>$attrs</code>在孙子组件上，将数据传递给孙子组件；</p> <p>子组件中的<code>$listeners</code>包含了父组件绑定在子组件上的事件，使用 v-on 绑定<code>$listeners</code>在孙子组件上，将事件传递给孙子组件。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// 父A：传递list
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span>
  <span class="token attr-name">:messagec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messagec<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@getCData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getCData<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@getChildData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getChildData(message)<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  methods: { getChildData(val) { console.log(`这是来自B组件的数据：${val}`); }, getCData(val) {
  console.log(`这是来自C组件的数据：${val}`); } } // 子B
  <span class="token comment">&lt;!-- C组件中能直接触发 getCData 的原因在于：B组件调用 C组件时，使用 v-on 绑定了 $listeners 属性 --&gt;</span>
  <span class="token comment">&lt;!-- 通过v-bind 绑定 $attrs 属性，C组件可以直接获取到 A组件中传递下来的 props（除了 B组件中 props声明的） --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>C</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>C</span><span class="token punctuation">&gt;</span></span>
  props: ['message'], data(){ return { mymessage: this.message } }, methods: { passData(val){
  //触发父组件中的事件 this.$emit('getChildData', val) } } // 子孙C
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs.messagec<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>passCData($attrs.messagec)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  methods: { passCData(val) { // 触发父组件A中的事件 this.$emit('getCData',val) } }
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="_4-parent"><a href="#_4-parent" class="header-anchor">#</a> 4）$parent</h5> <p><code>$parent</code> ：在子组件中调用，获取其所在父组件的实例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子组件</span>
<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    boymessage<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>message
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boymessage<span class="token punctuation">;</span><span class="token comment">//通过如此调用可以改变父组件的值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-2-子-父"><a href="#_5-2-子-父" class="header-anchor">#</a> 5.2 子--&gt;父</h3> <ul><li><strong>$emit / v-on</strong>：将数据作为<code>this.$emit</code>方法的参数，回传给父组件用<code>v-on：[自定义事件]</code>监听的函数。</li> <li><strong>ref / $refs</strong>：父组件通过调用子组件 ref 名获取数据或调用方法，并且获取的是实时数据。</li> <li><strong>$children</strong>：子组件的实例对象，是数组类型的，并不保证顺序，也不是响应式的。</li></ul> <h5 id="_1-emit-v-on"><a href="#_1-emit-v-on" class="header-anchor">#</a> 1）$emit / v-on</h5> <p>通过在子组件中触发一个自定义事件 xxx，将数据作为方法的参数，<code>this.$emit(xxx,参数)</code>回传给父组件，父组件用<code>v-on:xxx=&quot;handler&quot;</code>监听。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// 父组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span> <span class="token attr-name"><span class="token namespace">v-on:</span>sendData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getSonText<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> son <span class="token keyword">from</span> <span class="token string">'./son.vue'</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">getSonText</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code>// 子组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">sendData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'sendData'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="_2-ref-refs"><a href="#_2-ref-refs" class="header-anchor">#</a> 2）ref / $refs</h5> <p>通过 ref 对子组件做标记，父组件可以通过<code>vm.$refs.[子组件的ref].[子组件的属性/方法]</code>这种方式直接取得子组件的数据、和方法，并且获取的是实时数据。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// 父组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token function">submitForm</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
        _this<span class="token punctuation">.</span>data <span class="token operator">=</span> _this<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>tableData
        <span class="token comment">//只要子组件的data中有tableData这个数据，我们就能在父组件中获取到他</span>
        _this<span class="token punctuation">.</span>flag<span class="token operator">=</span> _this<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>msg<span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//只要子组件的methods中有sendMsg这个方法，我们就能在父组件中调用他</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="_3-children"><a href="#_3-children" class="header-anchor">#</a> 3）$children</h5> <p><code>$children</code>：在父组件中使用，返回的是一个子组件 Array。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 父</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>boymessage <span class="token operator">=</span> <span class="token string">'hello'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-3-兄-弟"><a href="#_5-3-兄-弟" class="header-anchor">#</a> 5.3 兄--&gt;弟</h3> <ul><li><strong>子传父、父传子</strong></li> <li><strong>EventBus</strong>：新建一个 <code>Vue</code> 对象 <code>bus</code>，挂载到 Vue.prototype，然后通过 <code>bus.$emit</code> 触发事件，<code>bus.$on</code> 监听触发的事件。</li> <li><strong>Vuex</strong>：使用<code>commit</code>触发一个<code>mutation</code>修改 store 中的 state 数据，通过<code>this.$store.state.[属性名]</code>获取 vuex 仓库中的数据</li></ul> <h5 id="_1-eventbus-事件总线"><a href="#_1-eventbus-事件总线" class="header-anchor">#</a> 1）EventBus 事件总线</h5> <p>通过新建一个 <code>Vue</code> 对象 <code>bus</code>，挂载到 Vue.prototype，然后通过 <code>bus.$emit</code> 触发事件，<code>bus.$on</code> 监听触发的事件。</p> <p><strong>原理</strong>：事件总线是一种发布订阅模式。注册时就将订阅者存在一个数组中，发布时就触发事件 <code>bus.$emit</code>，然后通过<code>.notify()</code>进行发布，订阅者通过<code>bus.$on</code>进行监听</p> <p>相比之下，vuex 会将通知的概念上升到共享状态层次，有利于后期代码的维护。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建总的事件池</span>
<span class="token keyword">const</span> EventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将事件总线赋值到 Vue.prototype 上，这样所有组件都能访问到了</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$EventBus <span class="token operator">=</span> EventBus<span class="token punctuation">;</span>

<span class="token comment">// 组件A 通知事件池中的方法执行</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$EventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'globalEvent'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
<span class="token comment">// 组件B  把方法加入到事件池</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$EventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'globalEvent'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>brothermessage <span class="token operator">=</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 取消</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$EventBus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'globalEvent'</span><span class="token punctuation">)</span>；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="_2-vuex"><a href="#_2-vuex" class="header-anchor">#</a> 2）Vuex</h5> <ul><li>使用<code>this.$store.commit('[函数名]', {'[state属性名]': 属性值})</code>更新 vuex 仓库中的数据。</li> <li>使用<code>this.$store.state.[属性名]</code>获取 vuex 仓库中的数据。</li> <li>将 state 和 mutations 挂载到 Vuex.Store 实例上去</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 兄弟组件A（B结构一样）</span>
<span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;transform&quot;</span><span class="token operator">&gt;</span>点我让<span class="token constant">B</span>组件接收到数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>因为你点了<span class="token constant">B</span>，所以我的信息发生了变化：<span class="token punctuation">{</span><span class="token punctuation">{</span>BMessage<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        AMessage<span class="token operator">:</span> <span class="token string">'Hello，B组件，我是A组件'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">BMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里存储从store里获取的B组件的数据</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>BMsg
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 触发receiveAMsg，将A组件的数据存放到store里去</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'receiveAMsg'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          AMsg<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>AMessage
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>store.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化A和B组件的数据，等待获取</span>
  AMsg<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  BMsg<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">receiveAMsg</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将A组件的数据存放于state</span>
    state<span class="token punctuation">.</span>AMsg <span class="token operator">=</span> payload<span class="token punctuation">.</span>AMsg
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">receiveBMsg</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将B组件的数据存放于state</span>
    state<span class="token punctuation">.</span>BMsg <span class="token operator">=</span> payload<span class="token punctuation">.</span>BMsg
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  mutations
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_6-vuex"><a href="#_6-vuex" class="header-anchor">#</a> 6. Vuex</h2> <h3 id="_6-1-vuex-基本用法"><a href="#_6-1-vuex-基本用法" class="header-anchor">#</a> 6.1 Vuex 基本用法</h3> <p><strong>概念</strong>：</p> <p>Vuex 是为了解决组件间的数据交互。它是 Vue 的状态管理器，采用<strong>集中式存储</strong>管理应用的所有组件的状态。它的核心是 store 仓库，就是一个容器，包含着应用中大部分的状态 state。</p> <p><strong>优点</strong>：</p> <ul><li>能够在 Vuex 中集中管理共享的数居，易于开发和后期维护</li> <li>能够高效地实现组件之间的数据共享，提高开发效率</li> <li>存储在 vuex 中的数据都是响应式的，能够实时保持数据与页面的同步</li></ul> <p><strong>基本使用</strong>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// store/index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token comment">// 1. 创建Vuex实例</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">// 2.把Vuex实例 注入到根组件，每个组件就拥有$store属性</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li><strong>state</strong> <ul><li>存放组件之间需要共享的公共状态，即 Vuex 中的基本数据。</li> <li><code>state:{count:2}</code></li> <li>通过<code>this.$store.state.count</code>访问</li> <li>从<code>vuex</code>中导入<code>mapState</code>函数，将当前组件需要的全局数据，映射为当前组件的<code>computed</code>计算属性，<code>...mapState(['count'])</code>。对象形式，可以自定义名称，<code>...mapState({count123:'count'})</code></li></ul></li> <li><strong>getters</strong> <ul><li>可以对 state 中的数据进行加工处理形成新的数据（类似计算属性）<strong>。不会修改 state 中的原数据</strong>。当多个组件共用一套处理逻辑时选择使用。</li> <li><code>getters:{countInfo(state, getters){return '数量：'+state.count}}</code></li> <li>通过<code>this.$store.getters.showNum</code>访问</li> <li>从<code>vuex</code>中导入<code>mapGetters</code>函数，将当前组件需要的 getter，映射为当前组件的<code>computed</code>计算属性，<code>...mapGetters(['showNum'])</code></li></ul></li> <li><strong>mutations</strong> <ul><li>存储用来更改 state 中数据的<strong>同步方法**</strong>。只有 mutations 里的函数，才有权利修改 state 的数据；mutations 里不能包含异步操作**。为了方便状态可控，修改状态有迹可循。</li> <li><code>mutations:{sub(state,option){state.count-=option}}</code></li> <li><code>this.$store.commit('sub',1)</code>触发 mutations 里定义的函数</li> <li>从<code>vuex</code>中导入<code>mapMutations</code>函数，将当前组件需要的 mutations 函数，映射为当前组件的<code>methods</code>函数，<code>...mapMutations(['sub'])</code></li></ul></li> <li><strong>actions</strong> <ul><li>由于直接在 mutations 中进行异步操作会引起数据失效，因此提供 actions 专门进行异步任务**。在 actions 中不能直接修改 state 中的数据，还是要通过触发 Mutation 的方式间接变更数据**。</li> <li><code>actions:{subAsync(store,option){setTimeout(()=&gt;{store.commit('sub',option)},1000)}}</code> <ul><li><code>this.$store.dispatch('subAsync',1)</code>触发 Actions 里定义的函数</li></ul></li> <li>从<code>vuex</code>中导入<code>mapActions</code>函数，将当前组件需要的 actions 函数，映射为当前组件的<code>methods</code>函数，<code>...mapActions(['subAsync'])</code></li></ul></li> <li><strong>modules</strong> <ul><li>使用单一状态树，导致应用的所有状态集中到一个很大的对象。但是，当应用变得很大时，store 对象会变得臃肿不堪。因此，Vuex 允许我们将 store 分割到模块，每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块。</li> <li><code>modules:{a:moduleA,b:moduleB}</code></li> <li><code>this.$store.state.a this.$store.state.b</code></li> <li>默认情况下，模块内部的 action 等注册在全局命名空间，这样使得多个模块能够对同一 mutation 或 action 作出响应。在模块下加<code>namespaced:true</code>，会把当前模块作为一个封闭空间，调用时需要指定模块，<code>this.$store.commit('user/sub',1)</code></li></ul></li></ul> <h3 id="_6-2-vuex-工作流程"><a href="#_6-2-vuex-工作流程" class="header-anchor">#</a> 6.2 Vuex 工作流程</h3> <ol><li>在 vue 组件里面，通过 dispatch 来触发异步任务 actions（如，ajax 请求）提交修改数据的操作。</li> <li>访问后端接口，然后获取后端返回数据。</li> <li>然后通过 commit 触发 mutations 更新数据</li> <li>通过 Mutate 修改 state 里面的数据。</li> <li>最后由 store 触发每一个调用它的组件的数据更新。</li></ol> <img src="https://img-blog.csdnimg.cn/20200521181420101.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ1MzE1Njk3,size_16,color_FFFFFF,t_70" alt="vuex流程" style="zoom:80%;"> <h3 id="_6-3-vuex-原理"><a href="#_6-3-vuex-原理" class="header-anchor">#</a> 6.3 Vuex 原理</h3> <ul><li>Vuex 本质是一个对象。Vuex 有两个属性，一个是 install 方法，一个是 Store 这个类。
<ul><li>install 方法的作用是将 store 这个实例挂载到所有的组件上，注意是同一个 store 实例。</li> <li>Store 这个类拥有<code>commit</code>，<code>dispatch</code>这些方法，Store 类里将用户传入的<code>state</code>包装成 data，作为 new Vue 的参数，从而实现了<code>state</code> 值的响应式。改变状态的唯一途径就是提交<code>mutations</code>。</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>


<span class="token comment">// App.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>state<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>num<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>getter<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>getNum<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;add&quot;</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;asyncAdd&quot;</span><span class="token operator">&gt;</span>异步<span class="token operator">+</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'incre'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">asyncAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'asyncIncre'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


<span class="token comment">// store/index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'./myVuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    num<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getNum</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>num <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">incre</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>num <span class="token operator">+=</span> arg
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">asyncIncre</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
      commit
    <span class="token punctuation">}</span><span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'incre'</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// store/myVuex.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>    <span class="token comment">// Vuex中的store本质就是没有template的隐藏着的vue组件。</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   <span class="token comment">// Vuex的状态存储是响应式的</span>
            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    state<span class="token operator">:</span> options<span class="token punctuation">.</span>state
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">let</span> getters <span class="token operator">=</span> options<span class="token punctuation">.</span>getters <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>getters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">getterName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">,</span> getterName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> getters<span class="token punctuation">[</span>getterName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>mutations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">let</span> mutations <span class="token operator">=</span> options<span class="token punctuation">.</span>mutations <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>mutations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">mutationName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>mutationName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                mutations<span class="token punctuation">[</span>mutationName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">let</span> actions <span class="token operator">=</span> options<span class="token punctuation">.</span>actions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">actionName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">[</span>actionName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                actions<span class="token punctuation">[</span>actionName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">get</span> <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>state
    <span class="token punctuation">}</span>

    <span class="token function-variable function">commit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果是根组件</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">//如果是子组件</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>$store
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> Vuex <span class="token operator">=</span> <span class="token punctuation">{</span>
    Store<span class="token punctuation">,</span>
    install
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Vuex
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br></div></div><h2 id="_7-vuerouter"><a href="#_7-vuerouter" class="header-anchor">#</a> 7. VueRouter</h2> <h3 id="_7-1-前端路由"><a href="#_7-1-前端路由" class="header-anchor">#</a> 7.1 前端路由</h3> <p><strong>为什么会出现前端路由？</strong></p> <ul><li><p>多页面应用 MPA</p> <ul><li><p>特点：</p> <ul><li>浏览器在地址栏中切换不同的 URL 时，每次都向后台服务器发出请求，服务器响应请求，在后台拼接 html 文件返回给前端，并且每次切换页面时，浏览器都会刷新页面。（页面跳转 =&gt; 返回 HTML）</li> <li>在后端，路由映射表中就是<strong>不同的 URL 地址</strong>与<strong>不同的 html + css + 后端数据</strong>之间的映射。</li></ul></li> <li><p>优点</p> <ul><li>首屏时间快</li> <li>有利于 SEO</li> <li>页面复杂度不高，开发成本较低</li></ul></li> <li><p>缺点：</p> <ul><li>页面切换慢，用户体验差</li> <li>代码重复度大，不利于后期维护</li> <li>对服务器的压力较大</li></ul></li></ul></li> <li><p>单页面应用 SPA</p> <ul><li><p>特点</p> <ul><li>通常仅在第一次进入页面时会向后台服务器请求一个 html 文件和所有必需的 CSS、JS 代码，之后所有的活动都局限在该页面。当用户操作改变页面时，它不会向后端请求一个新的 html，而是利用 JS 动态地变换 HTML 里的元素，渲染出一个新页面。（页面跳转 =&gt; JS 渲染）</li></ul></li> <li><p>优点：</p> <ul><li>页面切换快，用户体验好</li> <li>代码的可复用，且由于是组件化开发，有利于后期的维护</li> <li>对服务器的压力较小</li></ul></li> <li><p>缺点：</p> <ul><li><p>首屏时间慢（初始加载时候需要加载所有模块文件进行渲染）</p> <ul><li>骨架图，loadding 效果</li> <li>SSR，组件和页面通过服务器生成 html 字符串，再发送到浏览器。vue 可以使用 Nuxt.js 实现服务端渲染。</li> <li>路由懒加载，减少入口文件体积</li> <li>静态资源本地缓存</li> <li>UI 框架在引用时按需加载</li></ul></li> <li><p>不利于 SEO（因为搜索引擎是根据网页内容设置网页权重，来进行网页的排名。它只认识 html 内容，不认识 js 内容，而 SPA 的内容都是靠 js 渲染生成出来的）</p> <ul><li>预渲染，SSR</li></ul></li> <li><p>只有一个 url，SPA 无法记住用户的操作记录，页面发生变化后，无法利用浏览器工具栏上的倒退、前进按钮进行操作。</p> <ul><li>为了有效地使用单个页面来管理原来多页面的功能，<strong>前端路由出现</strong>。通过切换浏览器地址路径，来匹配相对应的页面组件，通过记录浏览过的历史路由信息，可以很好的记录历史查看过的界面。</li></ul></li> <li><p>页面复杂度变大，开发难度较大</p></li></ul></li></ul></li></ul> <p><strong>前端路由是什么，解决了什么问题？</strong></p> <ul><li>前端路由：通过一套映射规则（url 路径-&gt;组件）让用户从一个视图导航到另一个视图。在保证只有一个 HTML 页面，且与用户交互时不刷新和跳转页面的同时，为 SPA 中的每个视图展示形式匹配一个特殊的 url。在刷新、前进、后退和 SEO 时均通过这个特殊的 url 来实现。</li> <li>目标：改变 URL 却不引起页面刷新；可以监听到 URL 的变化。</li></ul> <p><strong>前端路由实现的原理</strong>：</p> <ul><li><p><strong>hash 模式</strong></p> <ul><li><p>hash 就是指 URL 后的 ## 号以及后面的字符，比如说 &quot;<a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.baidu.com%2F%23hashhash" target="_blank" rel="noopener noreferrer">www.baidu.com/#hashhash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot; ，其中 &quot;#hashhash&quot; 就是我们期望的 hash 值。</p></li> <li><p>hash 虽然出现在 URL 中，但不会被包括在 HTTP 请求中，对服务器端完全无用，因此，改变 hash 值不会刷新页面。</p></li> <li><p>通过 hashchange 事件监听 URL 的变化。</p> <ul><li>通过浏览器前进后退改变 URL</li> <li>通过<code>&lt;a&gt;</code>标签改变 URL</li> <li>通过 window.location 改变 URL</li></ul></li> <li><p>每一次改变 hash，都会在浏览器的访问历史中增加一个记录</p></li> <li><p>hash 模式下，仅 hash 符号之前的内容会被包含在请求中，对于后端来说，即使没有做到对路由的全覆盖，也不会返回 404 错误。</p></li> <li><p>API</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">'hash字符串'</span> <span class="token comment">// 用于设置 hash 值</span>

<span class="token keyword">let</span> hash <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token comment">// 获取当前 hash 值</span>

<span class="token comment">// 监听hash变化，点击浏览器的前进后退会触发</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'hashchange'</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> newURL <span class="token operator">=</span> event<span class="token punctuation">.</span>newURL <span class="token comment">// hash 改变后的新 url</span>
    <span class="token keyword">let</span> oldURL <span class="token operator">=</span> event<span class="token punctuation">.</span>oldURL <span class="token comment">// hash 改变前的旧 url</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// HashRouter.js</span>
<span class="token keyword">class</span> <span class="token class-name">HashRouter</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">register</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span>hash<span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">registerIndex</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">registerNotFound</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'404'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">registerError</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> hash <span class="token operator">=</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> handler<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'404'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span>hash<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// HashRouter.html</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;nav&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#/page1&quot;</span><span class="token operator">&gt;</span>page1<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#/page2&quot;</span><span class="token operator">&gt;</span>page2<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#/page3&quot;</span><span class="token operator">&gt;</span>page3<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./HashRouter.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">registerIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'首页'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/page1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/page2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/page3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抛出一个异常'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">registerNotFound</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'页面未找到'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">registerError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'页面异常&lt;br&gt;错误消息：'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><ul><li><p><strong>history 模式</strong></p> <ul><li><p>history 提供了 pushState 和 replaceState 两个方法，这两个方法改变 URL 的 path 部分不会引起页面刷新。</p></li> <li><p>popstate 事件</p> <ul><li>通过浏览器前进后退改变 URL 时会触发</li> <li>通过 pushState/replaceState 或<code>&lt;a&gt;</code>标签改变 URL <strong>不会</strong>触发 popstate 事件。
<ul><li>但我们可以拦截 pushState/replaceState 的调用和<code>&lt;a&gt;</code>标签的点击事件来检测 URL 变化</li></ul></li> <li>通过 js 调用 history 的 back，go，forward 方法会触发</li></ul></li> <li><p>在使用 <code>history</code> 模式时，需要<strong>通过服务端来允许地址可访问</strong>，如果没有设置，就很容易导致出现 <code>404</code> 的局面。</p></li> <li><p>API</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 后退一页</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 前进两页</span>
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 前进一页</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 后退一页</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 添加新的状态到历史状态栈</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 用新的状态代替当前状态</span>
history<span class="token punctuation">.</span>state                <span class="token comment">// 返回当前状态对象</span>

history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 和 history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 均接收三个参数（state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url）
    state：合法的 Javascript 对象，可以用在 popstate 事件中
    title：现在大多浏览器忽略这个参数，可以直接用 <span class="token keyword">null</span> 代替
    url：任意有效的 <span class="token constant">URL</span>，用于更新浏览器的地址栏
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 和 history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 的区别在于：
		history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 在保留现有历史记录的同时，将 url 加入到历史记录中。
		history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 会将历史记录中的当前页面历史替换为 url。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// HistoryRouter.js</span>
<span class="token keyword">class</span> <span class="token class-name">HistoryRouter</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenPopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">register</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">registerIndex</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">registerNotFound</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'404'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">registerError</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">assign</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            path
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealPathHandler</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">replace</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            path
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealPathHandler</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">dealPathHandler</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> handler<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'404'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>routers<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> path <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealPathHandler</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">listenPopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> state <span class="token operator">=</span> e<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                path <span class="token operator">=</span> state<span class="token punctuation">.</span>path <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dealPathHandler</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">listenLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> dom <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'A'</span> <span class="token operator">&amp;&amp;</span> dom<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// e.preventDefault()</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// HistoryRouter.html</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;nav&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/page1&quot;</span><span class="token operator">&gt;</span>page1<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/page2&quot;</span><span class="token operator">&gt;</span>page2<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/page3&quot;</span><span class="token operator">&gt;</span>page3<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/page4&quot;</span><span class="token operator">&gt;</span>page4<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>page2<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./HistoryRouter.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HistoryRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">registerIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'首页'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/page1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/page2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/page3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抛出一个异常'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">registerNotFound</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'页面未找到'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">registerError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'页面异常&lt;br&gt;错误消息：'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'/page2'</span><span class="token punctuation">)</span>
        router<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><ul><li><strong>模式对比</strong> <ul><li><code>pushState()</code>设置的新 URL 可以是与当前 URL 同源的任意 URL；而 hash 只可修改#后面的部分</li> <li><code>pushState()</code>设置的新 URL 可以与当前 URL 一模一样，这样也会把记录添加到栈中；而 hash 设置的新值必须与原来不一样才会触发记录添加到栈中</li> <li><code>pushState()</code>通过<code>stateObject</code>参数可以添加任意类型的数据到记录中；而 hash 只可添加短字符串</li> <li><code>pushState()</code> 可额外设置 <code>title</code> 属性供后续使用。</li> <li><code>hash</code> 模式下，仅 hash 符号之前的内容会被包含在请求中，后端来即使没有做到对路由的全覆盖，也不会返回 404 错误；<code>history</code> 模式下，前端的 URL 必须和实际向后端发起请求的 URL 一致。</li></ul></li> <li>使用场景
<ul><li>当需要兼容低版本的浏览器时，建议使用 hash 模式。</li> <li>hash 模式下 url 会带有#，当你希望 url 更优雅时，可以使用 history 模式。</li> <li>当需要添加任意类型数据到记录时，可以使用 history 模式。</li> <li>当使用 history 模式时，需要注意在服务端增加一个覆盖所有情况的候选资源：如果 URL 匹配不到任何静态资源，则应该返回同一个 index.html 页面，这个页面就是你 app 依赖的页面。</li></ul></li></ul> <h3 id="_7-2-vuerouter-基本用法"><a href="#_7-2-vuerouter-基本用法" class="header-anchor">#</a> 7.2 VueRouter 基本用法</h3> <ul><li>从 vue-router 导入 VueRouter</li> <li>Vue.use(VueRouter)</li> <li>创建 VueRouter 实例，配置，导出实例</li> <li>挂载到根组件上</li> <li>在 App.js 中使用 router-link 和 router-view</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'../views/HomeView.vue'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> Home<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'about'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/AboutView.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 路由懒加载</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;nav&quot;</span><span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">&quot;/home&quot;</span><span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">&gt;</span>
			 <span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">&quot;/home&quot;</span><span class="token operator">&gt;</span>About<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><strong>router-link</strong>：Vue-Router 的内置组件，在具有路由功能的应用中作为声明式的导航使用。有 8 个 props。</p> <ul><li><code>to</code>：必填，表示目标路由的链接。当被点击后，内部会立刻把<code>to</code>的值传到<code>router.push()</code>，所以这个值可以是一个字符串或者是描述目标位置的对象。</li> <li><code>replace</code>：默认值为 false</li> <li><code>append</code>：设置 append 属性后，则在当前 (相对) 路径前添加基路径。</li> <li><code>tag</code>：让<code>&lt;router-link&gt;</code>渲染成<code>tag</code>设置的标签</li> <li><code>active-class</code>：默认值为<code>router-link-active</code>,设置链接激活时使用的 CSS 类名。</li> <li><code>exact-active-class</code>：默认值为<code>router-link-exact-active</code>,设置链接被精确匹配的时候应该激活的 class。</li> <li><code>exact</code>：是否精确匹配，默认为 false。</li> <li><code>event</code>：声明可以用来触发导航的事件。可以是一个字符串或是一个包含字符串的数组，默认是<code>click</code>。</li></ul> <p><strong>route 和 router 的区别</strong>：</p> <ul><li>route 是“路由信息对象”，提供了一系列路由的属性，包括 path，params，hash，query，fullPath，matched，name 等路由信息参数。</li> <li>router 是“路由实例对象”，提供一系列操作路由的方法，包括路由的跳转方法、钩子函数等。</li></ul> <p><strong>嵌套路由</strong>：</p> <ul><li>children 定义子路由，在父路由组件上要定义<code>&lt;router-view/&gt;</code>出口</li></ul> <h3 id="_7-3-vuerouter-原理"><a href="#_7-3-vuerouter-原理" class="header-anchor">#</a> 7.3 VueRouter 原理</h3> <ul><li>创建 VueRouter 类
<ul><li>constructor
<ul><li>mode</li> <li>routes,routesMap</li> <li>history</li></ul></li> <li>createMap：将 routes 转化为 path-component</li> <li>init：判断 mode 是 hash 还是 history，设置监听
<ul><li>hash：hashchange</li> <li>history：popstate</li></ul></li></ul></li> <li>创建 install 方法
<ul><li>添加混入，在 beforeCreate 中定义_root、_router，$router，$route</li> <li>创建 router-view 组件和 router-link 组件</li> <li>利用了 Vue 提供的 API：defineReactive，使得 this._router.history 对象得到监听</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>


<span class="token comment">// App.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">'nav'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">&gt;</span> <span class="token operator">|</span>
      <span class="token operator">&lt;</span>router<span class="token operator">-</span>link to<span class="token operator">=</span><span class="token string">&quot;/about&quot;</span><span class="token operator">&gt;</span>About<span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>router<span class="token operator">-</span>view <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>


<span class="token comment">// router/index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'./myVueRouter'</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'../views/HomeView.vue'</span>
<span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'../views/AboutView.vue'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Home<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'about'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> About<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  routes<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router


<span class="token comment">// router/myVueRouter.js</span>
<span class="token keyword">class</span> <span class="token class-name">HistoryRoute</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> options<span class="token punctuation">.</span>mode <span class="token operator">||</span> <span class="token string">'hash'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routes <span class="token operator">=</span> options<span class="token punctuation">.</span>routes <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routesMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routes<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HistoryRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">createMap</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      pre<span class="token punctuation">[</span>current<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">.</span>component
      <span class="token keyword">return</span> pre
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'hash'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 先判断用户打开时有没有hash值，没有的话跳转到#/</span>
      location<span class="token punctuation">.</span>hash <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      location<span class="token punctuation">.</span>pathname <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>pathname <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> Vue <span class="token operator">=</span> <span class="token keyword">null</span>
VueRouter<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue <span class="token operator">=</span> v
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果是根组件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">//把当前组件实例挂载到_root上</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router
        Vue<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//如果是子组件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>_root
      <span class="token punctuation">}</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'$router'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'$route'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">.</span>current
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-link'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      to<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> mode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router<span class="token punctuation">.</span>mode
      <span class="token keyword">let</span> to <span class="token operator">=</span> mode <span class="token operator">===</span> <span class="token string">'hash'</span> <span class="token operator">?</span> <span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> href<span class="token operator">:</span> to <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'router-view'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">.</span>current
      <span class="token keyword">let</span> routeMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router<span class="token punctuation">.</span>routesMap
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>routeMap<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> VueRouter

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br></div></div><img src="\imgs\image-20200817215653874.png" alt="image-20200817215653874" style="zoom:80%;"> <h3 id="_7-4-导航守卫"><a href="#_7-4-导航守卫" class="header-anchor">#</a> 7.4 导航守卫</h3> <p><strong>概念</strong>：</p> <ul><li><p>导航守卫就是在路由跳转过程中的一些钩子函数，通过钩子函数在不同时段可以做不同的事。</p></li> <li><p>导航守卫都是在 Vue 实例生命周期钩子函数之前执行的。</p></li> <li><p>分类：全局守卫，路由守卫，组件守卫。</p></li></ul> <p><strong>1）全局守卫</strong>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 全局前置守卫，在路由跳转前，它在 每次导航 时都会触发。</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">-</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">to</span><span class="token template-punctuation string">`</span></span> 代表要进入的路由对象
<span class="token operator">-</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">from</span><span class="token template-punctuation string">`</span></span> 代表离开的路由对象
<span class="token operator">-</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">next</span><span class="token template-punctuation string">`</span></span> 是一个必须要执行的函数，否则不能进入路由<span class="token operator">**</span><span class="token punctuation">(</span>页面空白<span class="token punctuation">)</span><span class="token operator">**</span>
  <span class="token operator">-</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>： 执行下一个钩子函数
    <span class="token operator">-</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token function">：取消进入路由，url地址重置为from路由地址</span><span class="token punctuation">(</span>也就是将要离开的路由地址<span class="token punctuation">)</span>；
    <span class="token operator">-</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token function">或next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>： 跳转到一个不同的地址<span class="token punctuation">;</span>
    <span class="token operator">-</span> <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>： 如果传入 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">next</span><span class="token template-punctuation string">`</span></span> 的参数是一个 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error</span><span class="token template-punctuation string">`</span></span> 实例，则导航会被终止且该错误会被传递给 <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">router.onError()</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>注册过											的回调。


<span class="token comment">// 2. 全局解析守卫，在路由跳转前，所有 组件守卫 和 异步路由组件 被解析之后触发，它同样在 每次导航 时都会触发。</span>
router<span class="token punctuation">.</span><span class="token function">beforeResolve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 3. 全局后置守卫，在路由跳转完成后，组件守卫之前。它同样在 每次导航 时都会触发。 不接受next的参数</span>
router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>2）路由守卫</strong>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1. 在路由配置上定义 beforeEnter 守卫，此守卫只在进入路由时触发</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> Foo<span class="token punctuation">,</span>
      <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>3）组件守卫</strong>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token comment">// 1. 路由进入组件之前调用，该守卫内访问不到组件的实例，也就是 this 为 undefined，也就是他在 beforeCreate 生命周期前触发。</span>
  <span class="token function">beforeRouteEnter</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 2. 在当前路由改变，但是该组件被复用时调用，可以访问组件实例 this</span>
  <span class="token comment">//    可以在这里监听路由参数的变化</span>
  <span class="token function">beforeRouteUpdate</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 3. 导航离开该组件的对应路由时调用，可以访问组件实例 this</span>
  <span class="token comment">//    比较常用：清除当前组件中的定时器、提示用户保存</span>
  <span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>完整的导航解析流程</strong>：</p> <ol><li>导航被触发</li> <li>在将要离开的路由组件中调用<strong>beforeRouteLeave</strong></li> <li>调用全局前置守卫<strong>beforeEach</strong></li> <li>在重用的组件里调用 <strong>beforeRouteUpdate (2.2+)</strong></li> <li>在路由配置里调用 <strong>beforeEnter</strong></li> <li>解析异步路由组件</li> <li>在将要进入的路由组件中调用<strong>beforeRouteEnter</strong></li> <li>调用全局解析守卫<strong>beforeResolve(2.5+)</strong></li> <li>导航被确认</li> <li>调用全局后置钩子<strong>afterEach</strong></li> <li>触发 DOM 更新</li> <li>执行<strong>beforeRouteEnter</strong>的 **next **回调函数</li></ol> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f72fd5c28a54767b1892ebf9c307653~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="未命名文件.png" style="zoom:80%;"> <h3 id="_7-5-路由跳转方法"><a href="#_7-5-路由跳转方法" class="header-anchor">#</a> 7.5 路由跳转方法</h3> <p><strong>1）标签导航： router-link</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 不传参 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击验证动画效果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 传参 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>/user/<span class="token punctuation">'</span> + this.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>2）编程式导航： this.$router.方法</strong></p> <p>基于 JS 的 this.$router 下的方法实现路由跳转，相当于把 router-link 的规则转移到 JS 中。</p> <ul><li><p><code>this.$router.push({path:'/user',query:{id:100}})</code></p></li> <li><p><code>this.$router.replace({path:'/user'})</code></p></li> <li><p><code>this.$router.go(n)</code></p></li> <li><p><code>this.$router.forward()</code></p></li> <li><p><code>this.$router.back()</code></p></li></ul> <p><strong>三种 vue 路由跳转传参方式</strong></p> <p><strong>1.配置动态路由</strong></p> <ul><li>页面刷新，参数不会消失</li> <li>URl 路径会显示传递的参数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 路由配置</span>
<span class="token punctuation">{</span>
    path<span class="token operator">:</span>	<span class="token string">'/home/:id'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span><span class="token string">'Home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span>Home
<span class="token punctuation">}</span>

<span class="token comment">// 2. 跳转页面传参</span>
<span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/home/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>			<span class="token comment">// 字符串</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/home/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>	<span class="token comment">// 对象</span>

<span class="token comment">//3. 跳转后获取参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>2.query 传参</strong></p> <ul><li>页面刷新，参数不会消失</li> <li>URl 路径会显示传递的参数</li> <li>通过路由属性中的 path 来匹配路由</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 路由配置</span>
<span class="token punctuation">{</span>
    path<span class="token operator">:</span>	<span class="token string">'/home'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span><span class="token string">'Home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span>Home
<span class="token punctuation">}</span>

<span class="token comment">// 2. 跳转页面传参</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// 变成 /user?id=1</span>
    path<span class="token operator">:</span><span class="token string">'/home'</span><span class="token punctuation">,</span>
    query<span class="token operator">:</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//3. 跳转后获取参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>3.params 传参</strong></p> <ul><li>页面刷新，参数会消失</li> <li>URl 路径不会显示传递的参数</li> <li>通过路由属性中的 name 来匹配路由</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 路由配置</span>
<span class="token punctuation">{</span>
    path<span class="token operator">:</span><span class="token string">'/home'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span><span class="token string">'Home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span>Home
<span class="token punctuation">}</span>

<span class="token comment">// 2. 跳转页面传参</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'Home'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//3. 跳转后获取参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_7-6-动态路由"><a href="#_7-6-动态路由" class="header-anchor">#</a> 7.6 动态路由</h3> <p>将某种模式匹配到的所有路由，全部映射到同个组件。</p> <p>例如，有一个 <code>User</code> 组件，对于所有 ID 各不相同的用户，都要使用这个组件来渲染。那么，我们可以在 <code>vue-router</code> 的路由路径中使用“动态路径参数”来达到这个效果：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;User&lt;/div&gt;'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 动态路径参数 以冒号开头</span>
    <span class="token comment">// 像 `/user/foo` 和 `/user/bar` 都将映射到相同的路由</span>
    <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> User <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>鉴权-动态路由</strong></p> <ol><li>路由跳转 先判断是否登录 未登录只能访问白名单页面，访问其他页面全部重定向到登录页面</li> <li>登录行为触发，获取动态路由，递归解析动态路由信息，并且 addRouter，同时存储到 Vuex 并且记录获取路由的状态</li> <li>跳转页面不会获取动态路由，刷新页面重新获取动态路由</li></ol> <p><strong>动态加载路由</strong></p> <p>使用 Router 的实例方法 addRoutes 来实现动态加载路由，一般用来实现菜单权限。</p> <h2 id="_8-vue-渲染"><a href="#_8-vue-渲染" class="header-anchor">#</a> 8. Vue 渲染</h2> <img src="https://upload-images.jianshu.io/upload_images/13429147-32832d6b08b108c4.jpg?imageMogr2/auto-orient/strip|imageView2/2/format/webp" alt="img" style="zoom:50%;"> <h3 id="_8-1-虚拟-dom"><a href="#_8-1-虚拟-dom" class="header-anchor">#</a> 8.1 虚拟 DOM</h3> <p><strong>来源</strong>：由于在浏览器中操作 DOM 是很昂贵的，频繁的操作 DOM 会产生一定的性能问题。Vue2 的 Virtual DOM 借鉴了开源库 snabbdom 的实现，Virtual DOM 本质就是用一个原生的 JS 对象去描述一个 DOM 节点，是对真实 DOM 的一层抽象。</p> <p>**虚拟 DOM **：一个普通的 JavaScript 对象，包含了 <code>tag</code>、<code>props</code>、<code>children</code> 三个属性。</p> <p><strong>优点</strong>：</p> <ul><li>提高性能，<strong>不是说不操作 DOM，而是减少操作 DOM 的次数，减少回流和重绘</strong>。虚拟 dom 相当于在 js 和真实 dom 中间加了一个缓存，利用 diff 算法避免了没有必要的 dom 操作。</li> <li>无需手动操作 DOM，只需要写好 View-Model 的代码逻辑，框架会根据虚拟 DOM 和 数据双向绑定，帮我们以可预期的方式更新视图，极大提高我们的开发效率；</li> <li><strong>抽象了原本的渲染过程，实现了跨平台的能力</strong>，不局限于浏览器的 DOM，也可以是服务端渲染 SSR、安卓和 IOS 的原生组件、小程序。</li></ul> <p><strong>缺点</strong>：</p> <ul><li>首次渲染大量 DOM 时，由于多了一层虚拟 DOM 的计算，会比 innerHTML 插入慢。</li></ul> <p><strong>虚拟 DOM 算法的三个步骤</strong>：</p> <ul><li>用 <code>JS</code> 对象模拟 <code>DOM</code> 树 — <code>element.js</code></li> <li>比较两棵虚拟 <code>DOM</code> 树的差异 — <code>diff.js</code></li> <li>将两个虚拟 <code>DOM</code> 对象的差异应用到真正的 <code>DOM</code> 树 — <code>patch.js</code></li></ul> <p><strong>如果只有一个 DOM 操作，直接操作真实 DOM 性能是否更优？</strong></p> <ul><li>可以直接操作 DOM，但获取了性能的同时失去了代码的可维护性和后期开发效率。Vue 是采用声明式渲染的，如果单独用 js 操作某个真实 DOM，该操作不能被后期检测到。而且采取虚拟 DOM 的本质就是实现了跨平台的能力，比如服务端渲染 SSR、小程序等，顺带做一些能做的优化，单就一个操作讨论运行性能没有意义，在 VUE 的框架下就遵循 VUE 的范式；小范围直接操作 DOM 是允许的，但如果要跨平台渲染，就要注意了。</li></ul> <h3 id="_8-2-vnode"><a href="#_8-2-vnode" class="header-anchor">#</a> 8.2 VNode</h3> <p><strong><code>Virtual DOM</code>关键属性</strong></p> <ul><li><code>tag</code> ：这个<code>vnode</code>的标签属性</li> <li><code>data</code> ：包含了最后渲染成真实<code>dom</code>节点后，节点上的<code>class</code>，<code>attribute</code>，<code>style</code>以及绑定的事件</li> <li><code>children</code> ：<code>vnode</code>的子节点</li> <li><code>text</code> ：文本属性</li> <li><code>elm</code> ：这个<code>vnode</code>对应的真实<code>dom</code>节点</li> <li><code>key</code> ：<code>vnode</code>的标记，在<code>diff</code>过程中可以提高<code>diff</code>的效率</li></ul> <h3 id="_8-3-diff"><a href="#_8-3-diff" class="header-anchor">#</a> 8.3 Diff</h3> <p>Diff 算法：用来比较同层级的新旧节点差异的高效算法。</p> <p><strong>同层对比</strong>：新旧虚拟 DOM 对比的时候，Diff 算法比较只会在同层级进行，不会跨层级比较。 所以 Diff 算法是深度优先算法，时间复杂度为<code>O(n)</code>。<em>如果两颗树完全对比，老树的每一个节点都去遍历新树的节点，直到找到新树对应的节点，这个流程就是 <code>O(n^2)</code>，再紧接着找到不同之后，再计算最短修改距离然后修改节点，时间复杂度是 <code>O(n^3)</code>。</em></p> <p><strong>对比流程</strong>：</p> <ul><li><p>当数据改变时，会触发<code>setter</code>，并且通过<code>dep.notify</code>去通知所有订阅者 watcher，watcher 会调用 patch()函数比较新旧节点，更新相应的视图。</p></li> <li><p>patch(oldVnode, newVnode) ：对比当前同层的虚拟节点是否为同一种类型的标签</p> <ul><li>sameVnode(oldVnode, newVnode) ：判断是否为同一类型节点
<ul><li>key 是否相同</li> <li>标签名是否相同</li> <li>是否都为注释节点</li> <li>是否都定义了 data</li> <li>当标签为 input 时，type 是否相同</li></ul></li> <li><strong>是：继续执行 patchVnode 函数，进行深层对比</strong></li> <li>否：没必要对比了，直接整个节点替换成新虚拟节点</li></ul></li> <li><p>patchVnode(oldVnode, newVnode)：更新旧节点</p> <ul><li>找到对应的<code>真实DOM</code>，称为<code>el</code></li> <li>判断<code>newVnode</code>和<code>oldVnode</code>是否指向同一个对象，如果是，直接<code>return</code></li> <li>如果都有文本节点并且不相等，那么将<code>el</code>的文本节点设置为<code>newVnode</code>的文本节点</li> <li>如果<code>oldVnode</code>有子节点而<code>newVnode</code>没有，则删除<code>el</code>的子节点</li> <li>如果<code>oldVnode</code>没有子节点而<code>newVnode</code>有，则将<code>newVnode</code>的子节点真实化之后添加到<code>el</code></li> <li><strong>如果两者都有子节点，则执行<code>updateChildren</code>函数，比较子节点</strong></li></ul></li> <li><p>updateChildren(parentElm, oldCh, newCh)：比较子节点</p> <ul><li>首先给 <code>oldCh</code>和 <code>newCh</code> 分别分配一个 <code>startIndex</code> 和 <code>endIndex</code> 来作为遍历的索引，当<code>oldCh</code> 或者 <code>newCh</code> 遍历完后(遍历完的条件就是 <code>oldCh</code> 或者 <code>newCh</code> 的 <code>startIndex &gt;= endIndex</code> )，就停止<code>oldCh</code> 和 <code>newCh</code> 的 <code>diff</code> 过程。</li> <li>比较 oldCh 和 newCh 的首尾节点是否有相同的节点，判断是否是相同的节点，然后进行增删改移操作。
<ul><li>旧头与新头</li> <li>旧头与新尾</li> <li>旧尾与新头</li> <li>旧尾与新尾</li></ul></li> <li>如果以上逻辑都匹配不到，再把所有<code>oldVnode</code>的 <code>key</code> 做一个映射到<code>index</code>的 map，然后用 <code>newVnode</code> 的 <code>key</code> 去找出在旧节点中可以复用的位置。</li></ul></li></ul> <p><strong>v-for 为什么要加 key？</strong></p> <ul><li>如果不使用 key，Vue 会使用就地复用策略，即尽量使用已经存在的 DOM 元素，直接在已有的 DOM 上进行复用修改。key 的作用主要是给 VNode 添加唯一标识，通过这个 key，diff 操作可以更准确、更快速。</li> <li><strong>更准确</strong>：同级比较，在 sameVnode 函数 a.key === b.key 对比中可以避免就地复用的情况，所以会更加准确。</li> <li><strong>更快速</strong>：子节点比较，利用 key 的唯一性生成 map 对象来获取对应节点，比遍历方式更快。</li></ul> <h3 id="_8-4-模版编译渲染-compile"><a href="#_8-4-模版编译渲染-compile" class="header-anchor">#</a> 8.4 模版编译渲染（compile）</h3> <p>compile 的作用是解析模板，生成渲染模板的 render。</p> <img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/9/16c747ba0086422b~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="公众号" style="zoom:80%;"> <div class="language- line-numbers-mode"><pre class="language-text"><code>_c('div', [_c('span'), _v(num)])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>render 的作用是为了生成跟模板节点一一对应的 VNode</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    tag: &quot;div&quot;,
    children:[{
        tag: &quot;span&quot;,
        text: undefined
    },{
        tag: undefined
        text: &quot;111&quot;
    }]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><p>渲染到哪个根节点上：</p> <ul><li>有 el 属性，直接获取根节点</li> <li>没有 el 属性，调用$mount 获取根节点</li></ul></li> <li><p>渲染哪个模板：</p> <ul><li><p>有 render：优先执行 render 函数，render 优先级 &gt; template</p></li> <li><p>无 render：</p> <ul><li>有 template：拿 template 去解析成 render 函数的所需的格式，并调用 render 函数渲染</li> <li>无 template：拿 el 根节点的 outerHTML 去解析成 render 函数的所需的格式，并调用 render 函数渲染</li></ul></li></ul></li></ul> <p><strong>渲染的方式：无论什么情况，最后都统一是要使用 render 函数渲染</strong></p> <p><strong>步骤</strong>：</p> <ul><li><p>$mount 函数</p> <ul><li><p>initMixin(Vue)，把$mount 函数挂在 Vue 的原型上</p></li> <li><p>$mount 函数重点在于判断各属性的有无情况（render、template）</p></li> <li><p>然后把 template 传入 compileToFunctions 函数，生成一个 render 函数，把生成的 render 函数赋值到 options 的 render 属性上</p></li> <li><p>最后返回 Vue 实例</p></li> <li><p>_init(options)，如果 vm.$options.el存在，调用vm.$mount(vm.$options.el)</p></li></ul></li> <li><p>compileToFunctions 函数</p> <ul><li>parse 函数：接收 template 原始模板，按照模板的节点和数据生成对应的 AST</li> <li>optimize 函数：递归遍历每一个 AST 节点，标记静态节点（没有绑定任何动态数据），这样就知道哪部分不会变化，于是在页面需要更新时，减少去比对这部分 DOM。</li> <li>generate 函数：把前两步生成完善的 AST 组装成 render 字符串</li> <li>使用 with 改变 this 指向，返回生成的 render 函数</li></ul> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adf9f56dd2684042a8b4540275d1df0d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="在这里插入图片描述" style="zoom:80%;"></li> <li><p>运行 render 函数，获得虚拟 DOM</p> <ul><li>_c：创建元素节点虚拟 DOM</li> <li>_v：创建文本节点虚拟 DOM</li></ul></li> <li><p>当数据改变时，会触发<code>setter</code>，并且通过<code>dep.notify</code>去通知所有订阅者 watcher，watcher 会调用 patch()函数比较新旧节点，然后根据差异进行更新渲染，这里用到了 diff 算法，最终将虚拟 DOM 转真实 DOM 并渲染。</p></li></ul> <p><img src="%5Cimgs%5Cvue-render.jpg" alt="img"></p> <h2 id="_9-vue-事件绑定"><a href="#_9-vue-事件绑定" class="header-anchor">#</a> 9. Vue 事件绑定</h2> <ul><li><p>原生事件绑定是通过 addEventListener 绑定给真实元素的。</p></li> <li><p>组件事件绑定是通过 Vue 自定义的$on 实现的。如果要在组件上使用原生事件，需要加<code>.native</code>修饰符，这样就相当于在父组件中把子组件当做普通 html 标签，然后加上原生事件。</p> <ul><li>$on、$emit 是基于发布订阅模式的，维护一个事件中心，on 的时候将事件按名称存在事件中心里，称之为订阅者，然后 emit 将对应的事件进行发布，去执行事件中心里的对应的监听器。</li></ul></li></ul> <h2 id="_10-vue-nexttick"><a href="#_10-vue-nexttick" class="header-anchor">#</a> 10. Vue.nextTick</h2> <p><strong>作用</strong>：可以让我们在下次 <code>DOM</code> 更新循环结束之后执行延迟回调，用于获得更新后的 <code>DOM</code></p> <p><strong>原因</strong>：Vue 中 DOM 更新是一个异步的过程。当数据变化时 Vue 不会立刻更新 DOM，而是开启⼀个队列，把组件更新函数保存在队列中，在同⼀事件循环中发生的所有数据变更会异步的批量更新。这⼀策略导致我们对数据的修改不会立刻体现在 DOM 上，此时如果想要获取更新后的 DOM 状态，就需要使用 nextTick。</p> <p><strong>原理</strong>：注册异步任务来对任务进行处理，nextTick 主要使用了宏任务和微任务的原理，根据执行环境降级判断 <code>Promise.then</code> 、<code>MutationObserver</code> 、<code>setImmediate</code>、<code>setTimeout</code> 这四种方法，如果支持的话，便会使用该方法调用 <code>flushCallbacks</code> 函数。</p> <p><strong>应用场景</strong>：需要在视图更新之后，基于新的视图进行操作。</p> <ul><li>created()钩子函数进行的 DOM 操作一定要放在 Vue.nextTick()的回调函数中</li> <li>更改数据后当你想立即使用 js 操作新的视图的时候需要使用它</li></ul> <p>注意 mounted 不会承诺所有的子组件也都一起被挂载。如果希望等到整个视图都渲染完毕，可以用 vm.$nextTick 替换掉 mounted</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">mounted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Code that will run only after the entire view has been rendered</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_11-composition-api"><a href="#_11-composition-api" class="header-anchor">#</a> 11. Composition API</h2> <h3 id="_11-1-option-api"><a href="#_11-1-option-api" class="header-anchor">#</a> 11.1 Option API</h3> <p><strong>Option API</strong>：</p> <ul><li><p>在 Vue2 中常常会需要在特定的区域（data，methods，watch，computed...）编写负责相同功能的代码。</p></li> <li><p>优点：少量逻辑代码时非常便于阅读和理解。</p></li> <li><p>缺点：随着业务复杂度越来越高，代码量会不断的加大，但由于相关业务的代码需要遵循 option 的配置写到特定的区域，导致后续维护非常的复杂，代码可复用性也不高。</p></li> <li><p>适用场景：小型项目、或者业务逻辑比较简单的项目</p></li></ul> <p><strong>Composition API</strong>：</p> <ul><li>Vue3 使用基于函数组合的 API，把代码的逻辑抽离出来封装，并把封装的内容直接引用到生命周期里面。</li> <li>优点：逻辑的抽离，代码的复用，便于后期维护。</li> <li>适用场景：中大型项目、或者逻辑比较复杂的项目</li></ul> <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c2a22b42d42458e87d9d1c0e13bacfd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt="04.png" style="zoom:50%;"> <h3 id="_11-2-基本用法"><a href="#_11-2-基本用法" class="header-anchor">#</a> 11.2 基本用法</h3> <ul><li>抽离逻辑代码到一个函数，函数的命名约定为 <code>useXxx</code> 格式（React hooks 也是）；</li> <li>在 <code>setup</code> 中引用 <code>useXxx</code> 函数。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// useSum.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">useSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleSum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        a<span class="token punctuation">.</span>value <span class="token operator">=</span> a<span class="token punctuation">.</span>value <span class="token operator">+</span> b<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        a<span class="token punctuation">,</span>
        b<span class="token punctuation">,</span>
        handleSum
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// App.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> a <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> b <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;handleSum&quot;</span><span class="token operator">&gt;</span>hanleSum<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> useSum <span class="token keyword">from</span> <span class="token string">&quot;./composables/useSum&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> handleSum <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      a<span class="token punctuation">,</span>
      b<span class="token punctuation">,</span>
      handleSum<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="_11-3-与-vue-mixin-区别"><a href="#_11-3-与-vue-mixin-区别" class="header-anchor">#</a> 11.3 与 Vue.mixin 区别</h3> <ul><li>当一个组件混入大量不同的 mixins 的时候，会存在两个非常明显的问题：命名冲突和数据来源不清晰。</li> <li>用 hook 函数在组件中使用，即使去编写更多的 hook 函数，也不会出现命名冲突的问题，而且整个数据来源清晰。</li></ul> <h3 id="_11-4-与-react-hooks-区别"><a href="#_11-4-与-react-hooks-区别" class="header-anchor">#</a> 11.4 与 React Hooks 区别</h3> <p>Compositon API 设计思想借鉴了 React Hooks</p> <ul><li><code>Composition API</code>声明在<code>setup</code>函数内，一次组件实例化只调用一次<code>setup</code>；而<code>React Hook</code>每次重渲染都需要调用<code>Hook</code>，使得<code>React</code>的<code>GC</code>比<code>Vue</code>更有压力，性能也相对于<code>Vue</code>来说也较慢。</li> <li><code>Compositon API</code>的调用不需要顾虑调用顺序，也可以在循环、条件、嵌套函数中使用；而<code>React Hook</code>是根据<code>useState</code>调用的顺序来确定下一次重渲染时的<code>state</code>是来源于哪个<code>useState</code>，所以不能在循环、条件、嵌套函数中调用<code>Hook</code>，必须确保总是在你的<code>React</code>函数的顶层调用<code>Hook</code>，<code>useEffect</code>、<code>useMemo</code>等函数必须手动确定依赖关系。</li></ul> <h2 id="_12-vue2-0-与-vue3-0"><a href="#_12-vue2-0-与-vue3-0" class="header-anchor">#</a> 12. Vue2.0 与 Vue3.0</h2> <h3 id="_12-1-区别"><a href="#_12-1-区别" class="header-anchor">#</a> 12.1 区别</h3> <ul><li><p>挂载方式</p> <ul><li>vue2 是通过<code>new Vue</code>创建实例，通过参数 el 确定挂载的 dom 进行挂载，也可以不传 el 直接使用<code>app.$mount('#app')</code>。</li> <li>vue3 可以通过解构的方式拿到<code>createApp</code>方法，通过该方法得到 app，调用<code>mount</code>进行挂载。这也是 vue3<code>函数式编程</code>的设计理念，这种设计方式可以按需引入资源，更好的利用 tree-shaking（去除没用到的代码）来减小打包体积。</li></ul></li> <li><p>Composition API（核心）</p> <ul><li><p>setup 函数是一个新的组件选项，作为组件内使用 Composition API 的入口点。setup 返回一个对象。则对象的所有属性(<strong>它是响应式的数据</strong>)都可以直接在模板中使用。</p></li> <li><p>创建组件实例，然后初始化 props，紧接着调用<code>setup</code>函数，它会在<code>beforeCreate</code>钩子之前调用。</p></li> <li><p>ref：可传入任意类型的值并返回一个响应式且可改变的 ref 对象。ref 对象拥有一个指向内部值的单一属性<code>.value</code>,改变值的时候必须使用其 value 属性</p> <p>reactive：接受一个普通对象然后返回该普通对象的响应式代理。</p></li></ul></li> <li><p>生命周期函数</p> <ul><li>vue3 中移除了 beforeCreate 和 created，增加了<code>setup</code>函数。</li> <li>销毁生命周期钩子改名。</li> <li>其他周期函数基本就是命名上在 vue2.x 的基础上加上<code>on</code>前缀，以驼峰命名方式命名，要写到 setup 函数里面。</li> <li>还增加了 onRenderTracked 和 onRenderTriggered 调试钩子。</li></ul></li> <li><p>数据响应方式</p> <ul><li>使用：vue2 直接将数据放到了 data 中，通过 this.xx = xx 来改变。原理：vue2 是利用<code>object.defineProperty</code>和观察者模式来实现。</li> <li>使用：vue3 提供了<code>ref</code>和<code>reactive</code>，ref 定义的变量通过<code>变量.value = xxx</code>改变，reactive 定义的变量通过 obj.xxx = xxx 即可。原理：vue3 是利用<code>Proxy</code>和<code>Reflect</code>来实现，最大的优势就是 vue3 可以监听到数组、对象新增/删除以及多层嵌套数据结构的响应。基于 proxy 监听就是所谓的 lazy by default，就是只要你用到了才会监听，可以理解&quot;按需监听&quot;，官方给出的诠释是**：速度加倍，同时内存占用还减半**。</li></ul></li> <li><p>渲染函数 API</p> <ul><li>Vue2 中 h 函数作为参数传递给 render 函数，vue3 中 h 函数全局导入</li></ul></li> <li><p>模板语法变化 slot 具名插槽语法，自定义指令 v-model 升级</p></li></ul> <h3 id="_12-2-优缺点"><a href="#_12-2-优缺点" class="header-anchor">#</a> 12.2 优缺点</h3> <p><strong>Vue3.0 优点</strong>：</p> <ul><li><p>有更好的代码组织能力，有更好的逻辑抽离能力</p></li> <li><p>将 Vue 内部的绝大部分 api 对外暴露，使 Vue 具备开发大型项目的能力，例如 compile 编译 api 等</p></li> <li><p>webpack 的 treeshaking（它可以在打包时忽略没有用到的代码）支持度友好</p></li> <li><p>使用 Proxy 进行响应式变量定义，性能提高 1.2~2 倍</p></li> <li><p>可在 Vue2.0 中单独使用 composition-api 插件，或者直接用它开发插件</p></li> <li><p>ssr 快了 2~3 倍</p></li></ul> <p><strong>Vue3.0 缺点</strong>：</p> <ul><li>兼容性：vue3 不再支持 ie11；vue2 不支持 ie8 及以下，部分兼容 ie9 ，完全兼容 10 以上， 因为 vue 的响应式原理是基于 es5 的<code>Object.defineProperty()</code>，而这个方法不支持 ie8 及以下。。</li> <li>对于习惯了 vue2.0 开发模式的开发者来说，增加了心智负担，对开发者代码组织能力有体验</li></ul> <h3 id="_12-3-升级"><a href="#_12-3-升级" class="header-anchor">#</a> 12.3 升级</h3> <p><strong>Vue2 到 Vue3 的升级</strong>：</p> <ul><li>利用 gogocode 把 Vue2 的代码升级到 Vue3</li> <li>第三方组件库升级</li> <li>其他依赖升级</li> <li>根据提示修改部分不兼容的代码</li></ul> <h2 id="_14-vue-组件继承"><a href="#_14-vue-组件继承" class="header-anchor">#</a> 14. vue 组件继承</h2> <p><strong>执行顺序</strong>：Vue.extend &gt; Vue.mixin &gt; extends &gt; mixins &gt; 本身的钩子函数。（并且会被后面的覆盖）</p> <table><thead><tr><th style="text-align:center;">类型</th> <th>描述</th></tr></thead> <tbody><tr><td style="text-align:center;">Vue.extend</td> <td>Vue 构造器创建（继承 Vue 的）一个子类，可以通过 new 来新建一个实例，挂载到一个元素上。</td></tr> <tr><td style="text-align:center;">Vue.mixin</td> <td>（对 Vue 类的 options 进行混入）全局注册 mixin 之后创建的每个 Vue 实例都会有这些属性或方法。</td></tr> <tr><td style="text-align:center;">extends</td> <td><code>Array&lt; Object&gt;</code>对象数组类型，向 Vue 实例中混入多个组件，与组件中的对象和方法进行合并，可理解为<strong>多继承</strong></td></tr> <tr><td style="text-align:center;">mixins</td> <td><code>Object</code></td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> extend <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'extends created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> mixin1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mixin1 created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> mixin2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mixin2 created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> extend<span class="token punctuation">,</span>
  mixins<span class="token operator">:</span> <span class="token punctuation">[</span>mixin1<span class="token punctuation">,</span> mixin2<span class="token punctuation">]</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// extends created</span>
<span class="token comment">// mixin1 created</span>
<span class="token comment">// mixin2 created</span>
<span class="token comment">// created</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_14-1-vue-extend"><a href="#_14-1-vue-extend" class="header-anchor">#</a> 14.1 Vue.extend</h3> <p>使用基础 Vue 构造器，创建一个“子类”。参数是一个包含组件选项的对象。</p> <p><strong>具体使用</strong>：根据类 new 一个实例，并挂载到一个元素上。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mount-point<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建构造器</span>
<span class="token keyword">var</span> Profile <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;p&gt;{{firstName}} {{lastName}} aka {{alias}}&lt;/p&gt;'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      firstName<span class="token operator">:</span> <span class="token string">'Walter'</span><span class="token punctuation">,</span>
      lastName<span class="token operator">:</span> <span class="token string">'White'</span><span class="token punctuation">,</span>
      alias<span class="token operator">:</span> <span class="token string">'Heisenberg'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 Profile 实例，并挂载到一个元素上。</span>
<span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#mount-point'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Walter White aka Heisenberg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
// 效果
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_14-2-vue-mixin"><a href="#_14-2-vue-mixin" class="header-anchor">#</a> 14.2 Vue.mixin</h3> <p>全局注册一个 mixin 混入，注册之后创建的每个 Vue 实例都会有这些属性或方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 比如我们希望每一个Vue实例都有一个print方法，我们就可以这么做：</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">我是一个通过mixin注入的方法！</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_14-1-mixins-高阶组件"><a href="#_14-1-mixins-高阶组件" class="header-anchor">#</a> 14.1 Mixins 高阶组件</h3> <p>Mixins（混入）：复用代码的主要方式。</p> <p>可以混入多个，<code>Array&lt; Object&gt;</code>类型，其中的数组中的成员可以是不同类型的对象，可理解为<strong>多继承</strong>。</p> <p>在混入后与组件中的对象和方法进行合并，相当于扩展了父组件的对象与方法，可以理解为形成了一个新的组件。</p> <p>当组件和混入对象含有同名选项时：</p> <ul><li>数据对象在内部会进行递归合并，并在发生冲突时以组件数据优先。</li> <li>同名钩子函数将合并为一个数组，因此都将被调用。优先级：mixins &gt; 本身的钩子函数</li></ul> <p><strong>使用场景</strong>：在全局注册所有 vue 实例共享的 methods、filter 或者 hooks 等方法。</p> <h3 id="_14-2-extends"><a href="#_14-2-extends" class="header-anchor">#</a> 14.2 Extends</h3> <p><code>Object | Function</code>类型。可理解为<strong>单继承</strong>。</p> <p><strong>使用场景</strong>：当我们不需要全局去混入一些配置，比如想要获得一个 component，可以使用 Vue.component()，也可以使用 Vue.extend()。</p> <h3 id="_14-3-区别"><a href="#_14-3-区别" class="header-anchor">#</a> 14.3 区别</h3> <h2 id="_15-动态组件和异步组件"><a href="#_15-动态组件和异步组件" class="header-anchor">#</a> 15. 动态组件和异步组件</h2> <h3 id="_15-1-动态组件"><a href="#_15-1-动态组件" class="header-anchor">#</a> 15.1 动态组件</h3> <p>Vue.js 提供了一个特殊的元素 <code>&lt;component&gt;</code>用来动态地挂载不同的组件。<em>让多个组件使用同一个挂载点，并动态切换。</em></p> <h4 id="keep-alive"><a href="#keep-alive" class="header-anchor">#</a> keep-alive</h4> <p>keep-alive 是 vue 内置的组件，用 keep-alive 包裹组件时，会缓存不活动的组件实例，而不是销毁他们。主要用于保存组件状态或避免重复创建，避免重复渲染导致的性能问题。</p> <p><strong>特点</strong>：</p> <ul><li>它是一个抽象组件，自身不会渲染一个 dom 元素，也不会出现在组件的父组件链中。</li> <li>当组件在 keep-alive 内被切换，组件的 activated 和 deactivated 这两个生命周期钩子函数会被执行。组件一旦被缓存，再次渲染就不会执行 created、mounted 生命周期钩子函数。</li> <li>要求同时只有一个子组件被渲染。</li> <li>不会在函数式组件中正常工作，因为它们没有缓存实例。</li></ul> <p><strong>常用的属性有</strong>：</p> <ul><li>include：设置会被缓存的组件。</li> <li>exclude：设置不会被缓存的组件。</li> <li>max：限制缓存组件的最大数量。</li></ul> <p><strong>keep-alive 相关的生命周期钩子函数</strong>：</p> <ul><li>activated： 进入页面时触发。（常用来实现每次进入页面的时候重新获取最新的数据）</li> <li>deactivated：退出页面时触发。</li></ul> <p><strong>动态组件</strong>：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>allowList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:exclude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>noAllowList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComponent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>路由组件</strong>：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>allowList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:exclude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>noAllowList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>实现原理</strong>：</p> <p>组件通过插槽，获取第一个子节点。根据 include、exclude 判断是否需要缓存。通过组件的 key，判断是否命中缓存。利用 LRU 算法，更新缓存以及对应的 keys 数组，根据 max 控制缓存的最大组件数量。</p> <p><strong>应用</strong>：</p> <p>跳转到详情页面时，需要保持列表页的滚动条的深度及筛选条件等，等返回的时候依然在这个位置，这样可以提高用户体验。</p> <h3 id="_15-2-异步组件"><a href="#_15-2-异步组件" class="header-anchor">#</a> 15.2 异步组件</h3> <p><strong>优点</strong>：按需加载，提高首屏加载速度；具有缓存机制，无需多次加载。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'async-example'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 向 `resolve` 回调传递组件定义</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;I am async!&lt;/div&gt;'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_16-按需加载"><a href="#_16-按需加载" class="header-anchor">#</a> 16. 按需加载</h2> <ol><li><p><strong>require</strong></p> <p>vue-router 配置路由，使用 vue 的异步组件技术，可以实现按需加载**。一个组件生成一个 js 文件**</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/promisedemo'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'PromiseDemo'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'../components/PromiseDemo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>ES 的<code>import()</code></strong></p> <p>推荐使用这种方式（需要 webpack &gt; 2.4）</p> <ul><li><p>下面 2 行代码，没有指定 webpack 中 Chunk 名（webpackChunkName），每个组件打包成一个 js 文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">ImportFuncDemo1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/ImportFuncDemo1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">ImportFuncDemo2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/ImportFuncDemo2'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>下面 2 行代码，指定了相同的 webpack 中 Chunk 名（webpackChunkName），会合并打包成一个 js 文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">ImportFuncDemo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/ImportFuncDemo1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">ImportFuncDemo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/ImportFuncDemo2'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p><strong>webpack 提供的<code>require.ensure()</code></strong></p> <p>多个路由指定相同的 chunkName，会合并打包成一个 js 文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/promise'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Promise'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../components/Promise'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'demo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
     path<span class="token operator">:</span> <span class="token string">'/hello'</span><span class="token punctuation">,</span>
     name<span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
     <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../components/Hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'demo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol> <h2 id="_17-vue-错误处理机制"><a href="#_17-vue-错误处理机制" class="header-anchor">#</a> 17. Vue 错误处理机制</h2> <p><strong>1）errorHandler：全局错误处理函数</strong>，组件的渲染和观察期间未捕获错误的处理函数。这个 error handler 可以作用到所有的 Vue 应用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>err</code>指代 error 对象</li> <li><code>vm</code>指代 Vue 应用本身</li> <li><code>info</code>是一个 Vue 特有的字符串</li></ul> <p><strong>2）warnHandler：捕获 Vue warning</strong>。在生产环境是不起作用的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">warnHandler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> trace</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// trace代表了组件树</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3）renderError</strong>：不适用全局，只适用于非生产环境。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token function">renderError</span><span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'pre'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> style<span class="token operator">:</span> <span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'red'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>4）errorCaptured</strong></p> <p><strong>5）window.onerror (不仅仅针对 Vue)</strong>：全局的异常处理函数，可以抓取所有的 JavaScript 异常。</p> <h2 id="_18-vue-use-plugin"><a href="#_18-vue-use-plugin" class="header-anchor">#</a> 18. Vue.use(plugin)</h2> <h3 id="_18-1-原理"><a href="#_18-1-原理" class="header-anchor">#</a> 18.1 原理</h3> <p><strong><code>Vue.use()</code> 方法</strong>：</p> <ul><li>通过全局方法 <code>Vue.use()</code> 使用插件</li> <li><code>Vue.use()</code> 方法至少传入一个参数，该参数类型必须是 Object 或 Function，如果是 Object 那么这个 Object 需要定义一个 install 方法，如果是 Function 那么这个函数就被当做 install 方法。在 <code>Vue.use()</code> 执行时 install 会默认执行，当 install 执行时第一个参数就是 Vue，其他参数是 <code>Vue.use()</code> 执行时传入的其他参数。</li> <li><code>Vue.use()</code> 会自动阻止多次注册相同插件</li> <li><code>Vue.use()</code> 需要在你调用 <code>new Vue()</code> 启动应用之前完成</li></ul> <p><strong><code>Vue.use()</code> 源码</strong>：</p> <ul><li>在全局 api Vue 上定义了 use 方法，接收一个 plugin 参数可以是 Function 也可以是 Object。</li> <li>判断该插件是不是已经注册过，防止重复注册。</li> <li>获取除第一个之外的其他参数，这些参数准备在调用 install 方法的时候传入，然后将 Vue 添加到 args 列表的最前面。</li> <li>判断传入的第一个参数是 Object 还是 Function，执行那个对应的 install 方法，并将 args 作为参数传入。</li> <li>将插件添加到 installedPlugins 中，保证相同的插件不会反复被注册。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initUse</span><span class="token punctuation">(</span><span class="token parameter">Vue<span class="token operator">:</span> GlobalAPI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">plugin<span class="token operator">:</span> Function <span class="token operator">|</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> installedPlugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin<span class="token punctuation">.</span>install <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    installedPlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// toArray方法：将类数组转成真正的数组</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token operator">:</span> any<span class="token punctuation">,</span> start<span class="token operator">?</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  start <span class="token operator">=</span> start <span class="token operator">||</span> <span class="token number">0</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> list<span class="token punctuation">.</span>length <span class="token operator">-</span> start
  <span class="token keyword">const</span> ret<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>i <span class="token operator">+</span> start<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_18-2-作用"><a href="#_18-2-作用" class="header-anchor">#</a> 18.2 作用</h3> <p><code>Vue.use()</code> 的注册本质上就是执行了一个 install 方法，install 里的内容由开发者自己定义。</p> <p>在 install 里我们可以拿到 Vue ，那么和 Vue 相关的周边工作都可以考虑放在 <code>Vue.use()</code> 方法里。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>MyPlugin<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.添加全局方法或 property</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">myGlobalMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 2.绑定指令、过滤器、全局组件</span>
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 3.设置全局混入</span>
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 4.添加实例方法</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$myMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">methodOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_19-mixin"><a href="#_19-mixin" class="header-anchor">#</a> 19. Mixin</h2> <p><strong>概念</strong>：</p> <ul><li>将组件的公共逻辑或者配置提取出来，哪个组件需要用到时，直接将提取的这部分混入到组件内部即可。</li></ul> <p><strong>使用</strong>：</p> <ul><li>mixin 就是一个对象，包含 Vue 组件中的一些常见配置，如 data、methods、created 等等。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/mixin/index.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mixins <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      msg<span class="token operator">:</span> <span class="token string">&quot;我是小猪课堂&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是mixin中的created生命周期函数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是mixin中的mounted生命周期函数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">clickMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是mixin中的点击事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 局部混入</span>
<span class="token comment">// src/App.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;clickMe&quot;</span><span class="token operator">&gt;</span>点击我<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mixins <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./mixin/index&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
  mixins<span class="token operator">:</span> <span class="token punctuation">[</span>mixins<span class="token punctuation">]</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;组件调用minxi数据&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是组件的mounted生命周期函数&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// 全局混入</span>
<span class="token comment">// src/main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mixins <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./mixin/index&quot;</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span>mixins<span class="token punctuation">)</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p><strong>规则</strong>：</p> <ul><li>mixin 中的生命周期函数会和组件的生命周期函数一起合并执行。生命周期函数合并后执行顺序：先执行 mixin 中的，后执行组件的。</li> <li>mixin 中的 data 数据、方法在组件中也可以直接使用。</li> <li><strong>不同组件中的 mixin 是相互独立的</strong>，一个组件中改动了 mixin 中的数据，另一个引用了 mixin 的组件不会受影响。</li> <li>当 mixin 中的 data 数据与组件中的 data 数据冲突时，组件中的 data 数据会覆盖 mixin 中数据。</li> <li>当 mixin 中的方法与组件中的方法冲突时，实际调用的是组件中的方法。</li></ul> <p><strong>优点</strong>：</p> <ul><li>提高代码复用性</li> <li>无需传递状态</li> <li>维护方便，只需要修改一个地方即可</li></ul> <p><strong>缺点</strong>：</p> <ul><li>命名冲突</li> <li>滥用的话后期很难维护</li> <li>不好追溯源，排查问题稍显麻烦</li> <li>不能轻易的重复代码</li></ul> <h2 id="_21-ssr-和-csr"><a href="#_21-ssr-和-csr" class="header-anchor">#</a> 21. SSR 和 CSR</h2> <h3 id="_21-1-ssr"><a href="#_21-1-ssr" class="header-anchor">#</a> 21.1 SSR</h3> <p>Server Side Rendering，服务器端渲染。</p> <p>服务端把需要的组件或页面渲染成 HTML 字符串，再发给客户端，客户端只负责解析 HTML ，不需要去解析编译 js 操作 DOM**。数据拼接 HTML 字符串这件事放在服务端**</p> <ul><li><strong>好处</strong>：首屏渲染快、利于 SEO、可以生成缓存片段，生成静态化文件、节能（对比客户端渲染的耗电）、适合静态页面</li> <li><strong>坏处</strong>：不利于网站交互、用户体验较差、频繁的服务器请求、前后端耦合</li></ul> <h3 id="_21-2-csr"><a href="#_21-2-csr" class="header-anchor">#</a> 21.2 CSR</h3> <p>Client Side Rendering，客户端渲染。</p> <p>服务端把渲染的静态文件发给客户端，客户端跑了脚本后生成相应 DOM，然后渲染给用户，数据注入部分是客服端做的**。数据拼接 HTML 字符串这件事放在客户端**</p> <ul><li><strong>好处</strong>： 利于网站交互、网络传输数据量小、减少了服务器压力、前后端分离、局部刷新</li> <li><strong>坏处</strong>：首屏渲染慢、不利于 SEO</li></ul> <h3 id="_21-3-vue-ssr"><a href="#_21-3-vue-ssr" class="header-anchor">#</a> 21.3 Vue-SSR</h3> <p>普通<code>vue</code>是在客户端把标签渲染成 HTML ； <code>ssr</code>是在服务器渲染成 HTML 字符串后返回。</p> <p><code>ssr</code>是<code>vue</code>的服务端渲染技术，<code>nuxt</code>是一个可以用来做<code>ssr</code>服务端渲染开发的框架。</p> <p>缺点：开发条件会受到限制，服务器端渲染只支持 beforeCreate 和 created 两个钩子，当我们需要一些外部扩展库时需要特殊处理，服务端渲染应用程序也需要处于 Node.js 的运行环境。</p> <h2 id="_22-其他"><a href="#_22-其他" class="header-anchor">#</a> 22. 其他</h2> <h3 id="_22-1-scoped"><a href="#_22-1-scoped" class="header-anchor">#</a> 22.1 scoped</h3> <ol><li>给 HTML 的 dom 节点添加一个不重复的 data 属性（例如: data-v-5558831a）来唯一标识这个 dom 元素</li> <li>在每句 css 选择器的末尾（编译后生成的 css 语句）加一个当前组件的 data 属性选择器（例如：[data-v-5558831a]）来私有化样式</li></ol> <h3 id="_22-2-vue-的单向数据流"><a href="#_22-2-vue-的单向数据流" class="header-anchor">#</a> 22.2 Vue 的单向数据流</h3> <p>数据总是从父组件传到子组件，子组件没有权利修改父组件传过来的数据，只能请求父组件对原始数据进行修改（$emit）。</p> <h3 id="_22-3-vuex-页面刷新数据丢失怎么解决"><a href="#_22-3-vuex-页面刷新数据丢失怎么解决" class="header-anchor">#</a> 22.3 Vuex 页面刷新数据丢失怎么解决</h3> <p>需要做 vuex 数据持久化，一般使用本地存储的方案来保存数据，可以自己设计存储方案，也可以使用第三方插件。如使用 vuex-persist 插件，它就是为 Vuex 持久化存储而生的一个插件，不需要手动存取 storage ，而是直接将状态保存至 cookie 或者 localStorage 中。</p> <h3 id="_22-4-vuex-为什么要分模块并且加命名空间"><a href="#_22-4-vuex-为什么要分模块并且加命名空间" class="header-anchor">#</a> 22.4 Vuex 为什么要分模块并且加命名空间</h3> <p><strong>模块</strong>：由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。为了解决以上问题，Vuex 允许我们将 store 分割成模块（module）。每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块。</p> <p><strong>命名空间</strong>：默认情况下，模块内部的 action、mutation 和 getter 是注册在全局命名空间的，这样使得多个模块能够对同一 mutation 或 action 作出响应。如果希望你的模块具有更高的封装度和复用性，你可以通过添加 namespaced: true 的方式使其成为带命名空间的模块。当模块被注册后，它的所有 getter、action 及 mutation 都会自动根据模块注册的路径调整命名。</p> <h3 id="_22-5-vue-中使用了哪些设计模式"><a href="#_22-5-vue-中使用了哪些设计模式" class="header-anchor">#</a> 22.5 vue 中使用了哪些设计模式</h3> <ul><li><p>工厂模式</p> <ul><li>传入参数即可创建 Vue 实例</li> <li>虚拟 DOM 根据参数的不同返回基础标签的 Vnode 和组件 Vnode</li></ul></li> <li><p>单例模式</p> <ul><li>整个程序有且仅有一个实例</li> <li>vuex 和 vue-router 的插件注册方法 install 判断如果系统存在实例就直接返回掉</li></ul></li> <li><p>发布-订阅模式</p> <ul><li>vue 事件机制</li></ul></li> <li><p>观察者模式</p> <ul><li>响应式数据原理</li></ul></li> <li><p>装饰模式</p> <ul><li>@装饰器的用法</li></ul></li> <li><p>策略模式</p> <ul><li>选项的合并策略</li></ul></li></ul> <h3 id="_22-6-vue-的性能优化"><a href="#_22-6-vue-的性能优化" class="header-anchor">#</a> 22.6 Vue 的性能优化</h3> <ul><li>对象层级不要过深，否则性能就会差</li> <li>不需要响应式的数据不要放到 data 中（可以用 Object.freeze() 冻结数据）</li> <li>v-if 和 v-show 区分使用场景</li> <li>computed 和 watch 区分使用场景</li> <li>v-for 遍历必须加 key，key 最好是 id 值，且避免同时使用 v-if</li> <li>大数据列表和表格性能优化-虚拟列表/虚拟表格</li> <li>防止内部泄漏，组件销毁后把全局变量和事件销毁</li> <li>图片懒加载、路由懒加载、第三方插件的按需引入</li> <li>适当采用 keep-alive 缓存组件</li> <li>防抖、节流运用</li> <li>服务端渲染 SSR or 预渲染</li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/12/12 03:03:02</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_1-概述" class="sidebar-link reco-side-_1-概述" data-v-cb1513f6>1. 概述</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_1-1-对-vue-的整体理解" class="sidebar-link reco-side-_1-1-对-vue-的整体理解" data-v-cb1513f6>1.1 对 VUE 的整体理解</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_1-2-渐进式框架" class="sidebar-link reco-side-_1-2-渐进式框架" data-v-cb1513f6>1.2 渐进式框架</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_1-3-对比其他框架" class="sidebar-link reco-side-_1-3-对比其他框架" data-v-cb1513f6>1.3 对比其他框架</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_1-4-vue-cli-脚手架" class="sidebar-link reco-side-_1-4-vue-cli-脚手架" data-v-cb1513f6>1.4 vue-cli 脚手架</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_2-vue" class="sidebar-link reco-side-_2-vue" data-v-cb1513f6>2. VUE</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_2-1-vue-基础语法" class="sidebar-link reco-side-_2-1-vue-基础语法" data-v-cb1513f6>2.1 Vue 基础语法</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_2-2-小胡子语法" class="sidebar-link reco-side-_2-2-小胡子语法" data-v-cb1513f6>2.2 小胡子语法</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_2-3-vue-指令" class="sidebar-link reco-side-_2-3-vue-指令" data-v-cb1513f6>2.3 Vue 指令</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_2-4-修饰符" class="sidebar-link reco-side-_2-4-修饰符" data-v-cb1513f6>2.4 修饰符</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_3-vue-生命周期" class="sidebar-link reco-side-_3-vue-生命周期" data-v-cb1513f6>3. VUE 生命周期</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_3-1-vue2-0-生命周期" class="sidebar-link reco-side-_3-1-vue2-0-生命周期" data-v-cb1513f6>3.1 Vue2.0 生命周期</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_3-2-vue3-0-生命周期" class="sidebar-link reco-side-_3-2-vue3-0-生命周期" data-v-cb1513f6>3.2 Vue3.0 生命周期</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_3-3-父子组件生命周期" class="sidebar-link reco-side-_3-3-父子组件生命周期" data-v-cb1513f6>3.3 父子组件生命周期</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_3-4-父组件监听子组件的生命周期" class="sidebar-link reco-side-_3-4-父组件监听子组件的生命周期" data-v-cb1513f6>3.4 父组件监听子组件的生命周期</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_4-双向数据绑定" class="sidebar-link reco-side-_4-双向数据绑定" data-v-cb1513f6>4. 双向数据绑定</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_4-1-架构模式" class="sidebar-link reco-side-_4-1-架构模式" data-v-cb1513f6>4.1 架构模式</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_4-2-数据到视图绑定" class="sidebar-link reco-side-_4-2-数据到视图绑定" data-v-cb1513f6>4.2 数据到视图绑定</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_4-3-视图到数据绑定" class="sidebar-link reco-side-_4-3-视图到数据绑定" data-v-cb1513f6>4.3 视图到数据绑定</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_4-4-实现" class="sidebar-link reco-side-_4-4-实现" data-v-cb1513f6>4.4 实现</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_5-组件通信" class="sidebar-link reco-side-_5-组件通信" data-v-cb1513f6>5. 组件通信</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_5-1-父-子" class="sidebar-link reco-side-_5-1-父-子" data-v-cb1513f6>5.1 父--&gt;子</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_5-2-子-父" class="sidebar-link reco-side-_5-2-子-父" data-v-cb1513f6>5.2 子--&gt;父</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_5-3-兄-弟" class="sidebar-link reco-side-_5-3-兄-弟" data-v-cb1513f6>5.3 兄--&gt;弟</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_6-vuex" class="sidebar-link reco-side-_6-vuex" data-v-cb1513f6>6. Vuex</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_6-1-vuex-基本用法" class="sidebar-link reco-side-_6-1-vuex-基本用法" data-v-cb1513f6>6.1 Vuex 基本用法</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_6-2-vuex-工作流程" class="sidebar-link reco-side-_6-2-vuex-工作流程" data-v-cb1513f6>6.2 Vuex 工作流程</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_6-3-vuex-原理" class="sidebar-link reco-side-_6-3-vuex-原理" data-v-cb1513f6>6.3 Vuex 原理</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-vuerouter" class="sidebar-link reco-side-_7-vuerouter" data-v-cb1513f6>7. VueRouter</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-1-前端路由" class="sidebar-link reco-side-_7-1-前端路由" data-v-cb1513f6>7.1 前端路由</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-2-vuerouter-基本用法" class="sidebar-link reco-side-_7-2-vuerouter-基本用法" data-v-cb1513f6>7.2 VueRouter 基本用法</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-3-vuerouter-原理" class="sidebar-link reco-side-_7-3-vuerouter-原理" data-v-cb1513f6>7.3 VueRouter 原理</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-4-导航守卫" class="sidebar-link reco-side-_7-4-导航守卫" data-v-cb1513f6>7.4 导航守卫</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-5-路由跳转方法" class="sidebar-link reco-side-_7-5-路由跳转方法" data-v-cb1513f6>7.5 路由跳转方法</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_7-6-动态路由" class="sidebar-link reco-side-_7-6-动态路由" data-v-cb1513f6>7.6 动态路由</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_8-vue-渲染" class="sidebar-link reco-side-_8-vue-渲染" data-v-cb1513f6>8. Vue 渲染</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_8-1-虚拟-dom" class="sidebar-link reco-side-_8-1-虚拟-dom" data-v-cb1513f6>8.1 虚拟 DOM</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_8-2-vnode" class="sidebar-link reco-side-_8-2-vnode" data-v-cb1513f6>8.2 VNode</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_8-3-diff" class="sidebar-link reco-side-_8-3-diff" data-v-cb1513f6>8.3 Diff</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_8-4-模版编译渲染-compile" class="sidebar-link reco-side-_8-4-模版编译渲染-compile" data-v-cb1513f6>8.4 模版编译渲染（compile）</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_9-vue-事件绑定" class="sidebar-link reco-side-_9-vue-事件绑定" data-v-cb1513f6>9. Vue 事件绑定</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_10-vue-nexttick" class="sidebar-link reco-side-_10-vue-nexttick" data-v-cb1513f6>10. Vue.nextTick</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_11-composition-api" class="sidebar-link reco-side-_11-composition-api" data-v-cb1513f6>11. Composition API</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_11-1-option-api" class="sidebar-link reco-side-_11-1-option-api" data-v-cb1513f6>11.1 Option API</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_11-2-基本用法" class="sidebar-link reco-side-_11-2-基本用法" data-v-cb1513f6>11.2 基本用法</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_11-3-与-vue-mixin-区别" class="sidebar-link reco-side-_11-3-与-vue-mixin-区别" data-v-cb1513f6>11.3 与 Vue.mixin 区别</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_11-4-与-react-hooks-区别" class="sidebar-link reco-side-_11-4-与-react-hooks-区别" data-v-cb1513f6>11.4 与 React Hooks 区别</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_12-vue2-0-与-vue3-0" class="sidebar-link reco-side-_12-vue2-0-与-vue3-0" data-v-cb1513f6>12. Vue2.0 与 Vue3.0</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_12-1-区别" class="sidebar-link reco-side-_12-1-区别" data-v-cb1513f6>12.1 区别</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_12-2-优缺点" class="sidebar-link reco-side-_12-2-优缺点" data-v-cb1513f6>12.2 优缺点</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_12-3-升级" class="sidebar-link reco-side-_12-3-升级" data-v-cb1513f6>12.3 升级</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_14-vue-组件继承" class="sidebar-link reco-side-_14-vue-组件继承" data-v-cb1513f6>14. vue 组件继承</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_14-1-vue-extend" class="sidebar-link reco-side-_14-1-vue-extend" data-v-cb1513f6>14.1 Vue.extend</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_14-2-vue-mixin" class="sidebar-link reco-side-_14-2-vue-mixin" data-v-cb1513f6>14.2 Vue.mixin</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_14-1-mixins-高阶组件" class="sidebar-link reco-side-_14-1-mixins-高阶组件" data-v-cb1513f6>14.1 Mixins 高阶组件</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_14-2-extends" class="sidebar-link reco-side-_14-2-extends" data-v-cb1513f6>14.2 Extends</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_14-3-区别" class="sidebar-link reco-side-_14-3-区别" data-v-cb1513f6>14.3 区别</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_15-动态组件和异步组件" class="sidebar-link reco-side-_15-动态组件和异步组件" data-v-cb1513f6>15. 动态组件和异步组件</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_15-1-动态组件" class="sidebar-link reco-side-_15-1-动态组件" data-v-cb1513f6>15.1 动态组件</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_15-2-异步组件" class="sidebar-link reco-side-_15-2-异步组件" data-v-cb1513f6>15.2 异步组件</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_16-按需加载" class="sidebar-link reco-side-_16-按需加载" data-v-cb1513f6>16. 按需加载</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_17-vue-错误处理机制" class="sidebar-link reco-side-_17-vue-错误处理机制" data-v-cb1513f6>17. Vue 错误处理机制</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_18-vue-use-plugin" class="sidebar-link reco-side-_18-vue-use-plugin" data-v-cb1513f6>18. Vue.use(plugin)</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_18-1-原理" class="sidebar-link reco-side-_18-1-原理" data-v-cb1513f6>18.1 原理</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_18-2-作用" class="sidebar-link reco-side-_18-2-作用" data-v-cb1513f6>18.2 作用</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_19-mixin" class="sidebar-link reco-side-_19-mixin" data-v-cb1513f6>19. Mixin</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_21-ssr-和-csr" class="sidebar-link reco-side-_21-ssr-和-csr" data-v-cb1513f6>21. SSR 和 CSR</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_21-1-ssr" class="sidebar-link reco-side-_21-1-ssr" data-v-cb1513f6>21.1 SSR</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_21-2-csr" class="sidebar-link reco-side-_21-2-csr" data-v-cb1513f6>21.2 CSR</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_21-3-vue-ssr" class="sidebar-link reco-side-_21-3-vue-ssr" data-v-cb1513f6>21.3 Vue-SSR</a></li><li class="level-2" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-其他" class="sidebar-link reco-side-_22-其他" data-v-cb1513f6>22. 其他</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-1-scoped" class="sidebar-link reco-side-_22-1-scoped" data-v-cb1513f6>22.1 scoped</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-2-vue-的单向数据流" class="sidebar-link reco-side-_22-2-vue-的单向数据流" data-v-cb1513f6>22.2 Vue 的单向数据流</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-3-vuex-页面刷新数据丢失怎么解决" class="sidebar-link reco-side-_22-3-vuex-页面刷新数据丢失怎么解决" data-v-cb1513f6>22.3 Vuex 页面刷新数据丢失怎么解决</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-4-vuex-为什么要分模块并且加命名空间" class="sidebar-link reco-side-_22-4-vuex-为什么要分模块并且加命名空间" data-v-cb1513f6>22.4 Vuex 为什么要分模块并且加命名空间</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-5-vue-中使用了哪些设计模式" class="sidebar-link reco-side-_22-5-vue-中使用了哪些设计模式" data-v-cb1513f6>22.5 vue 中使用了哪些设计模式</a></li><li class="level-3" data-v-cb1513f6><a href="/blog/blogs/vue/vue.html#_22-6-vue-的性能优化" class="sidebar-link reco-side-_22-6-vue-的性能优化" data-v-cb1513f6>22.6 Vue 的性能优化</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      我是懒鱼，欢迎你的关注 
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="170" height="240" class="live2d" style="left:5px;bottom:-20px;opacity:0.8;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="http://music.163.com/song/media/outer/url?id=20110049.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:30px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://y.qq.com/music/photo_new/T002R300x300M000003zD6X70C6Ti6_2.jpg?max_age=2592000" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://y.qq.com/music/photo_new/T002R300x300M000003zD6X70C6Ti6_2.jpg?max_age=2592000);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>River Flows In You</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>Martin Ermen</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/blog/assets/js/app.387a4331.js" defer></script><script src="/blog/assets/js/3.726877f8.js" defer></script><script src="/blog/assets/js/1.9301d524.js" defer></script><script src="/blog/assets/js/87.c93cbf58.js" defer></script>
  </body>
</html>
